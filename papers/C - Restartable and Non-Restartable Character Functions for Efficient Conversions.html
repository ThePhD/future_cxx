<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>NXXXX: Restartable Functions for Efficient Character Conversions</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in § N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *     -> ins/del.c### for candidate and proposed changes (amendments)
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *   - .correction for "candidate corrections"       (div, aside, details, section)
 *   - .addition   for "candidate additions"         (div, aside, details, section)
 *   - .correction.proposed for "proposed corrections" (div, aside, details, section)
 *   - .addition.proposed   for "proposed additions"   (div, aside, details, section)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Outdated warning for old specs
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                    Body                                    */
/******************************************************************************/

	html {
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;			  /* limit line length to 50em for readability   */
		margin: 0 auto;				/* center text within page                    */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag    */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		color: black;
		color: var(--text);
		background: white top left fixed no-repeat;
		background: var(--bg) top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em; }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small; }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 3;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;	/* Inherit the font family. */
		line-height: 1.2;		/* Keep wrapped headings compact */
		hyphens: manual;		/* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#profile-and-date {
		/* #profile-and-date is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	border-left: 0.5em solid #DEF;
	border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	 padding: .5em;
	 border: thin solid #ddd;
	 border: thin solid var(--algo-border);
	 border-radius: .5em;
	 margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	 margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	 margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	margin-left: -2em;
	}
	dl.switch {
	padding-left: 2em;
	}
	dl.switch > dt {
	text-indent: -1.5em;
	margin-top: 1em;
	}
	dl.switch > dt + dt {
	margin-top: 0;
	}
	dl.switch > dt::before {
	content: '\21AA';
	padding: 0 0.5em 0 0;
	display: inline-block;
	width: 1em;
	text-align: right;
	line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: #aa0000;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #006100;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

	/* for amendments (candidate/proposed changes) */

	.amendment ins, .correction ins, .addition ins,
	ins[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment del, .correction del, .addition del,
	del[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment.proposed ins, .correction.proposed ins, .addition.proposed ins,
	ins[class^=c].proposed {
		text-decoration-style: double;
	}
	.amendment.proposed del, .correction.proposed del, .addition.proposed del,
	del[class^=c].proposed {
		text-decoration-style: double;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

	/* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: underline #707070;
		text-decoration: underline var(--a-normal-underline);
		text-decoration-skip-ink: none;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		text-decoration-color: #bbb;
		text-decoration-color: var(--a-visited-underline);
	}

	/* Indicate interaction with the link */
	a[href]:focus,
	a[href]:hover {
		text-decoration-thickness: 2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		text-decoration-color: #c00;
		text-decoration-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	  .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,	.sidefigure img,	figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em;
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em; }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote,
	.amendment, .correction, .addition {
		margin: 1em auto;
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	blockquote > :first-child,
	.note  > p:first-child,
	.issue > p:first-child,
	.amendment > p:first-child,
	.correction > p:first-child,
	.addition > p:first-child {
		margin-top: 0;
	}
	blockquote > :last-child,
	.note  > p:last-child,
	.issue > p:last-child,
	.amendment > p:last-child,
	.correction > p:last-child,
	.addition > p:last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker,
	.amendment::before, .amendment > .marker,
	details.amendment > summary > .marker,
	.addition::before, .addition > .marker,
	addition.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	correction.amendment > summary > .marker
	{
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	  or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	  or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	  or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Amendment Box *************************************************************/

	.amendment, .correction, .addition {
		border-color: #330099;
		border-color: var(--amendment-border);
		background: #F5F0FF;
		background: var(--amendment-bg);
		color: black;
		color: var(--amendment-text);
	}
	.amendment.proposed, .correction.proposed, .addition.proposed {
		border-style: solid;
		border-block-width: 0.25em;
	}
	.amendment::before, .amendment > .marker,
	details.amendment > summary::before, details.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	details.correction > summary::before, details.correction > summary > .marker,
	.addition::before, .addition > .marker,
	details.addition > summary::before, details.addition > summary > .marker {
		color: #220066;
		color: var(--amendmentheading-text);
	}
	.amendment.proposed::before, .amendment.proposed > .marker,
	details.amendment.proposed > summary::before, details.amendment.proposed > summary > .marker,
	.correction.proposed::before, .correction.proposed > .marker,
	details.correction.proposed > summary::before, details.correction.proposed > summary > .marker,
	.addition.proposed::before, .addition.proposed > .marker,
	details.addition.proposed > summary::before, details.addition.proposed > summary > .marker {
		font-weight: bold;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 0;
		right: 0;
		bottom: 2em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		<table class="data"> highlights structural relationships in a table
		when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		Use class="complex data" for particularly complicated tables --
		(This will draw more lines: busier, but clearer.)

		Use class="long" on table cells with paragraph-like contents
		(This will adjust text alignment accordingly.)
		Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding: 0.1rem 1px 0;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Switch to using border-bottom for underlines */
		text-decoration: none;
		border-bottom: 1px solid;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:focus,
	.toc a:hover {
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
	}
	.toc {
		line-height: 1.1em;
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li			{ font-weight: bold;   }
	.toc > li li		 { font-weight: normal; }
	.toc > li li li	  { font-size:   95%;	}
	.toc > li li li li	{ font-size:   90%;	}
	.toc > li li li li li { font-size:   85%;	}

	/* @supports not (display:grid) { */
		.toc > li			{ margin: 1.5rem 0;	}
		.toc > li li		 { margin: 0.3rem 0;	}
		.toc > li li li	  { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}
		.toc > li li li li .secno { font-size: 85%; }
		.toc > li li li li li .secno { font-size: 100%; }

		.toc li {
			clear: both;
		}

		:not(li) > .toc			 { margin-left:  5rem; }
		.toc .secno				 { margin-left: -5rem; }
		.toc > li li li .secno	  { margin-left: -7rem; }
		.toc > li li li li .secno	{ margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc			 { margin-left:  4rem; }
			.toc .secno				 { margin-left: -4rem; }
			.toc > li li li			 { margin-left:  1rem; }
			.toc > li li li .secno	  { margin-left: -5rem; }
			.toc > li li li li .secno	{ margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc			 { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno				 { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li			 { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno	  { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno	{ margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			  comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
			border-bottom: 3px solid transparent;
			margin-bottom: -3px;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom-color: #054572;
			border-bottom-color: var(--toclink-underline);
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index	  { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li	{ margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em; }
	ul.index dl	{ margin-top: 0; }
	ul.index dt	{ margin: .2em 0 .2em 20px;}
	ul.index dd	{ margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li a + span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/** Outdated warning **********************************************************/

.outdated-spec {
	color: black;
	color: var(--outdatedspec-text);
	background-color: rgba(0,0,0,0.5);
	background-color: var(--outdatedspec-bg);
}

.outdated-warning {
	position: fixed;
	bottom: 50%;
	left: 0;
	right: 0;
	margin: 0 auto;
	width: 50%;
	background: maroon;
	background: var(--outdated-bg);
	color: white;
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	position: absolute;
	top: 0;
	right:0;
	margin: 0;
	border: 0;
	padding: 0.25em 0.5em;
	background: transparent;
	color: white;
	color: var(--outdated-text);
	font:1em sans-serif;
	text-align:center;
}

.outdated-warning span {
	display: block;
}

.outdated-collapsed {
	bottom: 0;
	border-radius: 0;
	width: 100%;
	padding: 0;
}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}

		.outdated-warning {
			position: absolute;
			border-style: solid;
			border-color: red;
		}

		.outdated-warning input {
			display: none;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good item positioning:
		  "content column" is 50ems wide at max; less on smaller screens.
		  Extra space (after ToC + content) is empty on the right.

		  1. When item < content column, centers item in column.
		  2. When content < item < available, left-aligns.
		  3. When item > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			* http://lea.verou.me/2012/04/background-attachment-local/
			*
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
						top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
						top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
<style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }
  </style>
  <meta content="Bikeshed version 82ce88815, updated Thu Sep 7 16:33:55 2023 -0700" name="generator">
  <link href="https://thephd.dev/_vendor/future_cxx/papers/C%20-%20Efficient%20Character%20Conversions.html" rel="canonical">
  <link href="https://isocpp.org/favicon.ico" rel="icon">
  <meta content="7bc5201ff7fe90054defaf61c2927d6ceadd6e03" name="document-revision">
<style>
:root {
	/* Default (light) theme */
	--foreground-point: rgb(0,0,0);
	--background-point: rgb(255,255,255);

	--ins-text-color: rgb(0, 182, 15);
	--diff-ins-text-color: rgb(0, 176, 189);
	--del-text-color: rgb(255, 58, 58);
	--diff-del-text-color: rgb(139, 0, 194);
}

/* dark theme */
@media (prefers-color-scheme: dark) {
	:root {
		--foreground-point: rgb(255,255,255);
		--background-point: rgb(0,0,0);

		--ins-text-color: rgb(48, 255, 48);
		--diff-ins-text-color: rgb(91, 250, 255);
		--del-text-color: rgb(255, 52, 52);
		--diff-del-text-color: rgb(244, 129, 255);
	}
}

:root {
	--ins-text-background-color: color-mix(in srgb, var(--ins-text-color) 5%, var(--background-point));
	--ins-code-background-color: color-mix(in srgb, var(--ins-text-color) 15%, var(--background-point));
	--ins-text-decoration-color: color-mix(in srgb, var(--diff-ins-text-color) 10%, var(--foreground-point));
	--diff-ins-text-background-color: color-mix(in srgb, var(--diff-ins-text-color) 5%, var(--background-point));
	--diff-ins-code-background-color: color-mix(in srgb, var(--diff-ins-text-color) 15%, var(--background-point));
	--diff-ins-text-decoration-color: color-mix(in srgb, var(--diff-ins-text-color) 10%, var(--foreground-point));

	--del-text-background-color: color-mix(in srgb, var(--del-text-color) 5%, var(--background-point));
	--del-code-background-color: color-mix(in srgb, var(--del-text-color) 15%, var(--background-point));
	--del-text-decoration-color: color-mix(in srgb, var(--del-text-color) 10%, var(--foreground-point));
	--diff-del-text-background-color: color-mix(in srgb, var(--diff-del-text-color) 5%, var(--background-point));
	--diff-del-code-background-color: color-mix(in srgb, var(--diff-del-text-color) 15%, var(--background-point));
	--diff-del-text-decoration-color: color-mix(in srgb, var(--diff-del-text-color) 10%, var(--foreground-point));
}

@media print {
	.pagebreak { break-after: always }
}

ins .wording-section .highlight:not(.idl) { background: var(--ins-code-background-color); }
diff-ins .wording-section .highlight:not(.idl) { background: var(--diff-ins-code-background-color); }
del .wording-section .highlight:not(.idl) { background: var(--del-code-background-color); }
diff-del .wording-section .highlight:not(.idl) { background: var(--diff-del-code-background-color); }


.tg  {
	border-collapse: collapse;
	border-spacing:0;
}

.tg td{
	padding:10px 10px;
	border-style: solid;
	border-width:1px;
	overflow: hidden;
	word-break: normal;
	border-color: var(--table-border-color, unset);
}
.tg th{
	font-weight: normal;
	padding: 10px 10px;
	border-style: solid;
	border-width: 1px;
	overflow: hidden;
	word-break: normal;
	border-color: black;
}
.tg .tg-c3ow { 
	border-color: unset;
	text-align: center;
	vertical-align: top
}

.ins, ins, ins p, ins div, span.ins, span.ins * {
	background-color: var(--ins-text-background-color);
	background: var(--ins-text-background-color);
	color: var(--ins-text-color);
	text-decoration: underline;
	text-decoration-color: var(--ins-text-decoration-color);
}

.diff-ins, diff-ins, diff-ins p, diff-ins div, span.diff-ins, span.diff-ins * {
	background-color: var(--diff-ins-text-background-color);
	background: var(--diff-ins-text-background-color);
	color: var(--diff-ins-text-color);
	text-decoration: underline double;
	text-decoration-color: var(--diff-ins-text-decoration-color);
}

.del, del, del p, del div, span.del, span.del * {
	background-color: var(--del-text-background-color);
	background: var(--del-text-background-color);
	color: var(--del-text-color);
	text-decoration: line-through;
	text-decoration-color: var(--del-text-decoration-color);
}

.diff-del, diff-del, diff-del p, diff-del div, span.diff-del, span.diff-del * {
	background-color: var(--diff-del-text-background-color);
	background: var(--diff-del-text-background-color);
	color: var(--diff-del-text-color);
	text-decoration: line-through double;
	text-decoration-color: var(--diff-del-text-decoration-color);
}

code.c-kw {
	font-weight: bold;
}

math, span.math {
	font-family: serif;
	font-style: italic;
}

ul {
	list-style-type: "— ";
}

.wording-clause {
	counter-reset: wording-paragraph;
}

.wording-clause-header {
	font-size: 115%;
	display: block;
	padding-bottom: 1em;
	clear: both;
}

.wording-clause-number {
	font-weight: bold;
}

.wording-clause-title {
	font-weight: bold;
	margin: 2em;
}

.wording-clause-stable-tag {
	float: right;
}

.wording-clause-section-title {
	font-size: 105%;
	font-weight: bold;
}

.clause-stable-tag {
	float: right;
}

.footnote-ref {
	font-size: 75%;
	vertical-align: super;
}

.footnote {
	font-size: 75%;
	vertical-align: bottom;
}

div.wording-section {
	counter-reset: wording-paragraph;
}

div.wording-numbered, div.wording-newnumbered {
	margin-left: 2.5em;
	margin-top: 1em;
	margin-bottom: 1em;
}

div.wording-numbered:before, div.wording-newnumbered:before {
	position: absolute;
	margin-left: -2.5em;
	display: block;
}

div.wording-numbered:before {
	content: counter(wording-paragraph);
	counter-increment: wording-paragraph;
	font-size: smaller;
}

div.wording-newnumbered:before {
	content: counter(wording-paragraph)"✨";
	counter-increment: wording-paragraph;
	font-size: smaller;
}

div.wording-numbered-list ul, div.wording-newnumbered ul {
	counter-reset: wording-list-item;
}

div.wording-numbered-list li, div.wording-newnumbered li {
	margin-left: 4em;
}

div.wording-numbered-list li:before, div.wording-newnumbered li:before {
	position: absolute;
	margin-left: -4em;
	display: block;
}

div.wording-numbered-list li:before {
	font-size: smaller;
	content: "(" counter(wording-paragraph) "." counter(wording-list-item) ")";
	counter-increment: wording-list-item;
}

div.wording-newnumbered-list li:before {
	content: "(✨" counter(wording-paragraph) "." counter(wording-list-item) ")";
	counter-increment: wording-list-item;
}

div.wording-numbered-0 {
	counter-reset: wording-paragraph -1;
}

div.wording-numbered-1 {
	counter-reset: wording-paragraph 0;
}

div.wording-numbered-2 {
	counter-reset: wording-paragraph 1;
}

div.wording-numbered-3 {
	counter-reset: wording-paragraph 2;
}

div.wording-numbered-4 {
	counter-reset: wording-paragraph 3;
}

div.wording-numbered-5 {
	counter-reset: wording-paragraph 4;
}

div.wording-numbered-6 {
	counter-reset: wording-paragraph 5;
}

div.wording-numbered-7 {
	counter-reset: wording-paragraph 6;
}

div.wording-numbered-8 {
	counter-reset: wording-paragraph 7;
}

div.wording-numbered-9 {
	counter-reset: wording-paragraph 8;
}

div.wording-numbered-10 {
	counter-reset: wording-paragraph 9;
}

div.wording-numbered-11 {
	counter-reset: wording-paragraph 10;
}

div.wording-numbered-12 {
	counter-reset: wording-paragraph 11;
}

div.wording-numbered-13 {
	counter-reset: wording-paragraph 12;
}

div.wording-numbered-14 {
	counter-reset: wording-paragraph 13;
}

div.wording-numbered-15 {
	counter-reset: wording-paragraph 14;
}

div.wording-numbered-16 {
	counter-reset: wording-paragraph 15;
}

div.wording-numbered-17 {
	counter-reset: wording-paragraph 16;
}

div.wording-numbered-18 {
	counter-reset: wording-paragraph 17;
}

div.wording-numbered-19 {
	counter-reset: wording-paragraph 18;
}

div.wording-numbered-20 {
	counter-reset: wording-paragraph 19;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */


@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">NXXXX<br>Restartable Functions for Efficient Character Conversions</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Published Proposal, <time class="dt-updated" datetime="2023-01-31">2023-01-31</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Previous Revisions:
     <dd><a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3075.htm">N3075 (r10)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3031.htm">N3031 (r9)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2999.htm">N2999 (r8)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2966.htm">N2966 (r7)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2902.htm">N2902 (r6)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2730.htm">N2730 (r5)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2620.htm">N2620 (r4)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2595.pdf">n2595 (r3)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2500.pdf">n2500 (r2)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2440.pdf">n2440 (r1)</a>, <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2431.pdf">n2431 (r0)</a>
     <dt class="editor">Authors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:phdofthehouse@gmail.com">JeanHeyd Meneide</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:shepherd@soasis.org">Shepherd (Shepherd's Oasis LLC)</a>
     <dt>Latest:
     <dd><a href="https://thephd.dev/_vendor/future_cxx/papers/C%20-%20Efficient%20Character%20Conversions.html">https://thephd.dev/_vendor/future_cxx/papers/C%20-%20Efficient%20Character%20Conversions.html</a>
     <dt>Paper Source:
     <dd><a href="https://thephd.dev/_vendor/future_cxx/papers/source/C%20-%20Restartable%20and%20Non-Restartable%20Character%20Functions%20for%20Efficient%20Conversions.bs">GitHub ThePhD/future_cxx</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/ThePhD/future_cxx/issues">GitHub</a>
     <dt>Project:
     <dd>ISO/IEC 9899 Programming Languages — C, ISO/IEC JTC1/SC22/WG14
     <dt>Proposal Category:
     <dd>Library Feature Request
     <dt>Target:
     <dd>C2y/C3a
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Implementations firmly control what both the Wide Character and Multi-Byte Character strings are treated at runtime by the Standard Library. While this control is fine, users of the Standard Library have no portability guarantees about how these library functions may behave, especially in the face of encodings that do not support each other’s full codepage. And, despite additions to C11 for maybe-UTF16 and maybe-UTF32 encoded types, these functions only offer conversions of a single unit of information at a time, leaving orders of magnitude of performance on the table. This paper proposes and explores additional library functionality to allow users to retrieve multibyte and wide character into a statically known encoding to enhance the ability to work with text.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#changelog"><span class="secno">1</span> <span class="content">Changelog</span></a>
     <ol class="toc">
      <li><a href="#changelog-r12"><span class="secno">1.1</span> <span class="content">Revision 12 - January 4<sup>th</sup>, 2024</span></a>
      <li><a href="#changelog-r11"><span class="secno">1.2</span> <span class="content">Revision 11 - January 31<sup>st</sup>, 2023</span></a>
      <li><a href="#changelog-r10"><span class="secno">1.3</span> <span class="content">Revision 10 - January 5<sup>th</sup>, 2023</span></a>
      <li><a href="#changelog-r9"><span class="secno">1.4</span> <span class="content">Revision 9 - July 19<sup>th</sup>, 2022</span></a>
      <li><a href="#changelog-r8"><span class="secno">1.5</span> <span class="content">Revision 8 - June 17<sup>th</sup>, 2022</span></a>
      <li><a href="#changelog-r7"><span class="secno">1.6</span> <span class="content">Revision 7 - April 12<sup>th</sup>, 2022</span></a>
      <li><a href="#changelog-r6"><span class="secno">1.7</span> <span class="content">Revision 6 - January 1<sup>st</sup>, 2022</span></a>
      <li><a href="#changelog-r5"><span class="secno">1.8</span> <span class="content">Revision 5 - November 30<sup>th</sup>, 2021</span></a>
      <li><a href="#changelog-r4"><span class="secno">1.9</span> <span class="content">Revision 4 - December 1<sup>st</sup>, 2020</span></a>
      <li><a href="#changelog-r3"><span class="secno">1.10</span> <span class="content">Revision 3 - October 27<sup>th</sup>, 2020</span></a>
      <li><a href="#changelog-r0"><span class="secno">1.11</span> <span class="content">Revision 0-2 - March 2<sup>nd</sup>, 2020</span></a>
     </ol>
    <li>
     <a href="#intro"><span class="secno">2</span> <span class="content">Introduction and Motivation</span></a>
     <ol class="toc">
      <li><a href="#intro-problem-portability"><span class="secno">2.1</span> <span class="content">Problem 1: Lack of Portability</span></a>
      <li><a href="#intro-problem-what"><span class="secno">2.2</span> <span class="content">Problem 2: What is the Encoding?</span></a>
      <li><a href="#intro-problem-performance"><span class="secno">2.3</span> <span class="content">Problem 3: Performance</span></a>
      <li><a href="#intro-problem-roundtrip"><span class="secno">2.4</span> <span class="content">Problem 4: <code class="highlight"><c- b>wchar_t</c-></code> Cannot Roundtrip</span></a>
      <li><a href="#intro-problem-standard"><span class="secno">2.5</span> <span class="content">Problem 5: The C Standard Cannot Handle Existing Practice</span></a>
      <li><a href="#intro-summary"><span class="secno">2.6</span> <span class="content">In Summary</span></a>
     </ol>
    <li>
     <a href="#prior"><span class="secno">3</span> <span class="content">Prior Art</span></a>
     <ol class="toc">
      <li><a href="#prior-standard"><span class="secno">3.1</span> <span class="content">Standard C</span></a>
      <li><a href="#prior-win32"><span class="secno">3.2</span> <span class="content">Win32</span></a>
      <li><a href="#prior-nl_langinfo"><span class="secno">3.3</span> <span class="content"><code class="highlight"><c- n>nl_langinfo</c-></code></span></a>
      <li><a href="#prior-sdcc"><span class="secno">3.4</span> <span class="content">SDCC</span></a>
      <li><a href="#prior-iconv"><span class="secno">3.5</span> <span class="content">iconv/ICU</span></a>
     </ol>
    <li>
     <a href="#design"><span class="secno">4</span> <span class="content">Design</span></a>
     <ol class="toc">
      <li>
       <a href="#design-forms"><span class="secno">4.1</span> <span class="content">Which Function Form?</span></a>
       <ol class="toc">
        <li><a href="#design-forms-state"><span class="secno">4.1.1</span> <span class="content"><code class="highlight"><c- b>mbstate_t</c-></code> Parameter for Unicode-only Conversions?</span></a>
        <li><a href="#design-forms-simplify"><span class="secno">4.1.2</span> <span class="content">Simplification Without Loss of Functionality?</span></a>
        <li><a href="#design-forms-performance"><span class="secno">4.1.3</span> <span class="content">Performance of Double-Pointers?</span></a>
        <li><a href="#design-forms-struct"><span class="secno">4.1.4</span> <span class="content">Structure Returns?</span></a>
        <li><a href="#design-forms-choice"><span class="secno">4.1.5</span> <span class="content">Proposed Choice</span></a>
       </ol>
      <li><a href="#design-extension"><span class="secno">4.2</span> <span class="content">Extension Functions &amp; Methods (Building on top of this API)</span></a>
      <li><a href="#design-wchar_t"><span class="secno">4.3</span> <span class="content"><code class="highlight"><c- b>wchar_t</c-></code> and Existing practice</span></a>
     </ol>
    <li><a href="#conclusion"><span class="secno">5</span> <span class="content">Conclusion</span></a>
    <li>
     <a href="#wording"><span class="secno">6</span> <span class="content">Proposed Wording</span></a>
     <ol class="toc">
      <li><a href="#wording-intent"><span class="secno">6.1</span> <span class="content">Intent</span></a>
      <li>
       <a href="#wording-specification"><span class="secno">6.2</span> <span class="content">Proposed Specification</span></a>
       <ol class="toc">
        <li><a href="#wording-specification-3.7.3"><span class="secno">6.2.1</span> <span class="content">Modify §3.7.3 Wide Character to change the definition to remove the one-to-one correspondence</span></a>
        <li><a href="#wording-specification-6.10.9.2"><span class="secno">6.2.2</span> <span class="content">Modify §6.10.9.2 Environment Macros to add new wide literal-only predefined macro</span></a>
        <li><a href="#wording-specification-7.21"><span class="secno">6.2.3</span> <span class="content">Modify §7.21 Common Definitions <code class="highlight"><c- o>&lt;</c-><c- n>stddef</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> to Remove Harmful <code class="highlight"><c- b>wchar_t</c-></code> Text</span></a>
        <li><a href="#wording-specification-7.31"><span class="secno">6.2.4</span> <span class="content">Modify §7.31 Extended Multibyte and Wide Character Utilities <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> to Clarify Role of <code class="highlight"><c- b>wchar_t</c-></code></span></a>
        <li><a href="#wording-specification-6.2.9"><span class="secno">6.2.5</span> <span class="content">Modify §6.2.9 Encodings to include definitions of Code Point, Code Unit, Wide/Narrow Execution Encodings, and Encoding Error</span></a>
        <li><a href="#wording-specification-7.21.3"><span class="secno">6.2.6</span> <span class="content">Modify §7.21.3 Files to remove the italics from the term "encoding error", since it’s initial definition was moved to §6.2.9 Encodings</span></a>
        <li><a href="#wording-specification-7.S✨"><span class="secno">6.2.7</span> <span class="content">Create a new section §7.S✨ and §7.S✨.1 Text Transcoding Utilities</span></a>
        <li><a href="#wording-specification-7.S✨.2"><span class="secno">6.2.8</span> <span class="content">Create a new section §7.S✨.2 Single Unit Sized Conversion Functions</span></a>
        <li><a href="#wording-specification-7.S✨.3"><span class="secno">6.2.9</span> <span class="content">Create a new subsection §7.S✨.3 Multi Unit Sized Conversion Functions</span></a>
        <li><a href="#wording-specification-j.1"><span class="secno">6.2.10</span> <span class="content">Add unspecified behavior to Annex J.1 Unspecified behavior</span></a>
       </ol>
     </ol>
    <li><a href="#acknowledgements"><span class="secno">7</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#appendix"><span class="secno">8</span> <span class="content">Appendix</span></a>
     <ol class="toc">
      <li><a href="#appendix-proposed-utf"><span class="secno">8.1</span> <span class="content">(From revisions 0-3) What about UTF{X} ↔ UTF{Y} functions?</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <div class="pagebreak"></div>
   <h2 class="heading settled" data-level="1" id="changelog"><span class="secno">1. </span><span class="content">Changelog</span><a class="self-link" href="#changelog"></a></h2>
   <h3 class="heading settled" data-level="1.1" id="changelog-r12"><span class="secno">1.1. </span><span class="content">Revision 12 - January 4<sup>th</sup>, 2024</span><a class="self-link" href="#changelog-r12"></a></h3>
   <ul>
    <li data-md>
     <p>Fix minor typos in example specification.</p>
    <li data-md>
     <p>Point out that C++ has made a similar change for its <code class="highlight"><c- b>wchar_t</c-></code> in <a data-link-type="biblio" href="#biblio-p2460r2" title="Relax requirements on wchar_t to match existing practices">[p2460r2]</a> and that if we would like to remain in sync, C should consider following suit, as described in <a href="#design-wchar_t">§ 4.3 wchar_t and Existing practice</a>.</p>
    <li data-md>
     <p>Improve the set of macros available from <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> and predefined in the compiler based on feedback and discuss in <a href="#design-wchar_t">§ 4.3 wchar_t and Existing practice</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="1.2" id="changelog-r11"><span class="secno">1.2. </span><span class="content">Revision 11 - January 31<sup>st</sup>, 2023</span><a class="self-link" href="#changelog-r11"></a></h3>
   <ul>
    <li data-md>
     <p>Fix minor typos in example specification.</p>
    <li data-md>
     <p>Point out that C++ has made a similar change for its <code class="highlight"><c- b>wchar_t</c-></code> in <a data-link-type="biblio" href="#biblio-p2460r2" title="Relax requirements on wchar_t to match existing practices">[p2460r2]</a> and that if we would like to remain in sync, C should consider following suit, as described in <a href="#design-wchar_t">§ 4.3 wchar_t and Existing practice</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="1.3" id="changelog-r10"><span class="secno">1.3. </span><span class="content">Revision 10 - January 5<sup>th</sup>, 2023</span><a class="self-link" href="#changelog-r10"></a></h3>
   <ul>
    <li data-md>
     <p>Retargeting for C2y/C3a, after failure during the July 2022 Virtual Meeting to advance the state of Unicode.</p>
    <li data-md>
     <p>Apply all of the changes recommended by Hubert Tong, concerning <code class="highlight">\<c- mi>0</c-></code> write out (turn it into being a part of an indivisible unit of work), the "clear the <code class="highlight"><c- b>mbstate_t</c-></code>" footnote being applied to both places, and the new way to write the paragraph concerning what a valid <code class="highlight"><c- n>state</c-></code> is.</p>
    <li data-md>
     <p>WG14 could not decide between prefix vs. no-prefix, or prefix-but-only-for-macros. All votes came out even. In the interest of not trampling the user namespace and since this is an entirely new header, this paper restores the prefixes.</p>
    <li data-md>
     <p>Fix double-italicized <em>unrecorded encoding error</em> and leave only one (thanks, Aaron Ballman!).</p>
    <li data-md>
     <p>During the July 2022 Virtual Meeting, it was made clear that a DeathStation 9000 implementation could use the wording in the standard to ignore the multi-output capabilities of the new functions and still artificially restrict itself to UCS-2 and similar for "conformance" purposes. Therefore, the following specific wording changes were made to address such concerns:</p>
     <ul>
      <li data-md>
       <p>for the initial "wide character" definition (<a href="#wording-specification-3.7.3">§ 6.2.1 Modify §3.7.3 Wide Character to change the definition to remove the one-to-one correspondence</a>);</p>
      <li data-md>
       <p>for definition of pre-defined macros by the compiler (<a href="#wording-specification-6.10.9.2">§ 6.2.2 Modify §6.10.9.2 Environment Macros to add new wide literal-only predefined macro</a>);</p>
      <li data-md>
       <p>for definition of <code class="highlight"><c- b>wchar_t</c-></code> in <code class="highlight"><c- o>&lt;</c-><c- n>stddef</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> (<a href="#wording-specification-7.21">§ 6.2.3 Modify §7.21 Common Definitions &lt;stddef.h> to Remove Harmful wchar_t Text</a>);</p>
      <li data-md>
       <p>and, for usage of <code class="highlight"><c- b>wchar_t</c-></code> in <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code>’s specification (<a href="#wording-specification-7.31">§ 6.2.4 Modify §7.31 Extended Multibyte and Wide Character Utilities &lt;wchar.h> to Clarify Role of wchar_t</a>).</p>
     </ul>
   </ul>
   <h3 class="heading settled" data-level="1.4" id="changelog-r9"><span class="secno">1.4. </span><span class="content">Revision 9 - July 19<sup>th</sup>, 2022</span><a class="self-link" href="#changelog-r9"></a></h3>
   <ul>
    <li data-md>
     <p>Removed the <code class="highlight"><c- n>stdc_</c-></code> prefix in all of the prose.</p>
    <li data-md>
     <p>Wording changes:</p>
     <ul>
      <li data-md>
       <p>Removed the <code class="highlight"><c- n>stdc_</c-></code> prefix for the transcoding functions and <code class="highlight"><c- n>stdc_mcerr_</c-><c- o>*</c-></code>. (This particular change is not highlighted because it is a find-and-replace and would turn much of the paper a different color over what is a mechanical/editorial name change.)</p>
      <li data-md>
       <p>Remove freestanding changes.</p>
      <li data-md>
       <p>Add a new sentence for properly writing out the null character AND any preceding conversion state.</p>
      <li data-md>
       <p>Add a new paragraph to directly explain what states are valid to place into the functions (both the single and multi-conversion functions).</p>
      <li data-md>
       <p>Change the wording for when <code class="highlight"><c- n>state</c-></code> is a null pointer, saying instead: "automatic storage duration object of type <code class="highlight"><c- b>mbstate_t</c-></code> is created unique to the current invocation".</p>
      <li data-md>
       <p>Remove the text describing "first use" of <code class="highlight"><c- b>mbstate_t</c-></code> as it is now covered by the new paragraph.</p>
      <li data-md>
       <p>Add 1 new footnote to ensure users understand that they may lose conversion state data for restarting a conversion if the <code class="highlight"><c- b>mbstate_t</c-><c- o>*</c-></code> state parameter is not provided or is a null pointer.</p>
      <li data-md>
       <p>Add 1 new footnote to make it clear that the state can be reset by using <code class="highlight"><c- b>mbstate_t</c-> <c- n>s</c-> <c- o>=</c-> <c- p>{</c-><c- mi>0</c-><c- p>};</c-></code> with <code class="highlight"><c- n>s</c-> <c- o>=</c-> <c- p>(</c-><c- b>mbstate_t</c-><c- p>){</c-><c- mi>0</c-><c- p>};</c-></code>, as described in §7.30.6 (Extended multibyte/wide character conversion utilities).</p>
     </ul>
    <li data-md>
     <p>Greatest of thanks to Dr. H. for the continual review and catching most of my most glaring mistakes.</p>
   </ul>
   <h3 class="heading settled" data-level="1.5" id="changelog-r8"><span class="secno">1.5. </span><span class="content">Revision 8 - June 17<sup>th</sup>, 2022</span><a class="self-link" href="#changelog-r8"></a></h3>
   <ul>
    <li data-md>
     <p>Editorial changes:</p>
     <ul>
      <li data-md>
       <p>Use "is a null pointer" versus "is <code class="highlight">NULL</code>" and similar.</p>
      <li data-md>
       <p>Fix a grammar mistake for a sentence discussing code points.</p>
      <li data-md>
       <p>Use "initial shift state" over "initial conversion sequence"</p>
     </ul>
    <li data-md>
     <p>Talk about how <code class="highlight"><c- b>mbstate_t</c-></code> is not necessary for the u8/u16/u32 functions, but preserves function form for macro-generic programming.</p>
    <li data-md>
     <p>Wording changes:</p>
     <ul>
      <li data-md>
       <p>This header shall exist for freestanding.</p>
      <li data-md>
       <p>Define code point, code unit, encoding error, unrecorded encoding error, and more in 6.2.9 for use elsewhere.</p>
      <li data-md>
       <p>Properly change how the functions handle the <code class="highlight"><c- o>*</c-><c- n>state</c-></code> and <code class="highlight"><c- n>state</c-></code> object in the wording.</p>
      <li data-md>
       <p>Fix the problem with the specification of the output values when processing a null character value or when using <code class="highlight"><c- n>input</c-></code>/<code class="highlight"><c- o>*</c-><c- n>input</c-></code> that are null pointers.</p>
      <li data-md>
       <p>Adjust the specification to give proper unspecified behavior.</p>
      <li data-md>
       <p>Add Annex J.1 entry.</p>
     </ul>
   </ul>
   <h3 class="heading settled" data-level="1.6" id="changelog-r7"><span class="secno">1.6. </span><span class="content">Revision 7 - April 12<sup>th</sup>, 2022</span><a class="self-link" href="#changelog-r7"></a></h3>
   <ul>
    <li data-md>
     <p>Update definitions for when the <code class="highlight"><c- n>input</c-></code> pointer - and its pointed to pointer - are <code class="highlight">NULL</code>, and make sure they have identical behaviors.</p>
    <li data-md>
     <p>Update definitions for when the <code class="highlight"><c- n>output</c-></code> pointer - and its pointed to pointer - are <code class="highlight">NULL</code>, and make sure they have identical behaviors.</p>
    <li data-md>
     <p>Ensure that <code class="highlight"><c- b>mbstate_t</c-></code> is properly cleared to the initial conversion state on both <code class="highlight">NULL</code> input pointers or U+000000 being processed in the input string. Ensure that it outputs any code unit sequences to the output necessary to return the output to its initial conversion state as well (thanks, Hubert Tong!).</p>
    <li data-md>
     <p>Handle <code class="highlight"><c- n>LC_CTYPE</c-></code> being changed in the wording (it’s unspecified behavior) (thanks, Hubert Tong!).</p>
    <li data-md>
     <p>Switch to using <code class="highlight"><c- n>char8_t</c-></code> officially now that it has been accepted to C23 (thanks, Joseph Myers!).</p>
    <li data-md>
     <p><code class="highlight"><c- kr>restrict</c-></code> added to the function prototypes (<a href="#design-forms-choice">§ 4.1.5 Proposed Choice</a>).</p>
   </ul>
   <h3 class="heading settled" data-level="1.7" id="changelog-r6"><span class="secno">1.7. </span><span class="content">Revision 6 - January 1<sup>st</sup>, 2022</span><a class="self-link" href="#changelog-r6"></a></h3>
   <ul>
    <li data-md>
     <p>Add design critique for the latest interface suggestion in <a href="#design-forms">§ 4.1 Which Function Form?</a>.</p>
    <li data-md>
     <p>Remove all non-<code class="highlight"><c- b>mbstate_t</c-></code> functions, to reduce the function count, and change behavior of the function.</p>
    <li data-md>
     <p>Make sure <code class="highlight"><c- n>stdc_mcerr</c-></code> is meant to be a proper error enumeration and a typedef.</p>
    <li data-md>
     <p>Properly define <em>indivisible unit of work</em>.</p>
   </ul>
   <h3 class="heading settled" data-level="1.8" id="changelog-r5"><span class="secno">1.8. </span><span class="content">Revision 5 - November 30<sup>th</sup>, 2021</span><a class="self-link" href="#changelog-r5"></a></h3>
   <ul>
    <li data-md>
     <p>Design critique and benchmark 3 different styles of function declaration and discuss benefits.</p>
    <li data-md>
     <p>A full, independent implementation of <a data-link-type="biblio" href="#biblio-cuneicode" title="cuneicode - A spicy text library for C">this paper (and more) is now available</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="1.9" id="changelog-r4"><span class="secno">1.9. </span><span class="content">Revision 4 - December 1<sup>st</sup>, 2020</span><a class="self-link" href="#changelog-r4"></a></h3>
   <ul>
    <li data-md>
     <p>Add missing functions for c8/16/32 to the platform-specific variants.</p>
    <li data-md>
     <p>Ensure that <code class="highlight"><c- b>mbstate_t</c-></code> is used throughout rather than <code class="highlight"><c- n>mcstate_t</c-></code>.</p>
    <li data-md>
     <p>Explain behavior of <code class="highlight">NULL</code> for <code class="highlight"><c- b>mbstate_t</c-></code> to avoid use of global values.</p>
   </ul>
   <h3 class="heading settled" data-level="1.10" id="changelog-r3"><span class="secno">1.10. </span><span class="content">Revision 3 - October 27<sup>th</sup>, 2020</span><a class="self-link" href="#changelog-r3"></a></h3>
   <ul>
    <li data-md>
     <p>Completely Reformulate Paper based on community, musl-libc, and glibc feedback.</p>
    <li data-md>
     <p>Completely rewrite every section past <a href="#wording">§ 6 Proposed Wording</a>, and change many more.</p>
   </ul>
   <h3 class="heading settled" data-level="1.11" id="changelog-r0"><span class="secno">1.11. </span><span class="content">Revision 0-2 - March 2<sup>nd</sup>, 2020</span><a class="self-link" href="#changelog-r0"></a></h3>
   <ul>
    <li data-md>
     <p>Introduce new functions and gather consensus to move forward.</p>
    <li data-md>
     <p>Attempt to implement in other standard libraries and gather feedback.</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="intro"><span class="secno">2. </span><span class="content">Introduction and Motivation</span><a class="self-link" href="#intro"></a></h2>
   <p>C adopted conversion routines for the current active locale-derived/<code class="highlight"><c- n>LC_TYPE</c-></code>-controlled/implementation-defined encoding for Multibyte (<code class="highlight"><c- n>mb</c-></code>) Strings and Wide (<code class="highlight"><c- n>wc</c-></code>) Strings. While the rationale for having such conversion routines to and from Multibyte and Wide strings in the C library are not explicitly stated in the documents, it is easy to derive the many benefits of a full ecosystem of both restarting (<code class="highlight"><c- n>r</c-></code>) and non-restarting conversion routines for both single units and string-based bulk conversions for <code class="highlight"><c- n>mb</c-></code> and <code class="highlight"><c- n>wc</c-></code> strings. From ease of use with string literals to performance optimizations from bulk processing with vectorization and SIMD operations, the <code class="highlight"><c- n>mbs</c-><c- p>(</c-><c- n>r</c-><c- p>)</c-><c- n>towcs</c-></code> — and vice-versa — granted a rich and fertile ground upon which C library developers took advantage of platform amenities, encoding specifics, and hardware support to provide useful and fast abstractions upon which encoding-aware applications could build.</p>
   <p>Unfortunately, none of these API designs were granted to <code class="highlight"><c- n>char16_t</c-></code> (<code class="highlight"><c- n>c16</c-></code>) or <code class="highlight"><c- n>char32_t</c-></code> (<code class="highlight"><c- n>c32</c-></code>) conversion functions. Nor were they given a way to work with a well-defined 8-bit multibyte encoding such as UTF8 without having to first pin it down with platform-specific <code class="highlight"><c- n>setlocale</c-><c- p>(...)</c-></code> calls. This has resulted in a series of extremely vexing problems when trying to write a portable, reliable C library code that is not locked to a specific vendor.</p>
   <p>This paper looks at the problems, and then proposes a solution with the goal of hoping to arrive at a solution that is worth implementing for the C Standard Library.</p>
   <h3 class="heading settled" data-level="2.1" id="intro-problem-portability"><span class="secno">2.1. </span><span class="content">Problem 1: Lack of Portability</span><a class="self-link" href="#intro-problem-portability"></a></h3>
   <p>Already, Windows, z/OS, and POSIX platforms greatly differ in what they offer for <code class="highlight"><c- b>char</c-></code>-typed, Multibyte string encodings. EBCDIC is still in play after many decades. Windows’s Active Code Page functionality on its machine prevents portability even within its own ecosystem. Platforms where LANG environment variables control functionality make communication between even processes on the same hardware a silent and often unforeseen gamble for library developers. Using functions which convert to/from <code class="highlight"><c- n>mbs</c-></code> make it impossible to have stability guarantees not only between platforms, but for individual machines. Sometimes even cross-process communication becomes exceedingly problematic without opting into a serious amount of platform-specific or vendor-specific code and functionality to lock encodings in, harming the portability of C code greatly.</p>
   <p><code class="highlight"><c- b>wchar_t</c-></code> does not fare better. By definition, a wide character type must be capable of holding the entire character set in a single unit of <code class="highlight"><c- b>wchar_t</c-></code>. Reality, however, is different: this has been a fundamental impossibility for decades for implementers that switched to 16-bit UCS-2 early. IBM machines persist with this issue for all 32-bit builds, though some IBM platforms took advantage of the 64-bit change to do an ABI break and use UTF32 like other Linux distributions settled on. Even if one were to know this knowledge about IBM and program exclusively on their machines, certain IBM platforms can still end up in a situation where <code class="highlight"><c- b>wchar_t</c-></code> is neither 32-bit UTF32 or 16-bit UCS-2/UTF16: the encoding can change to something else in certain Chinese locales, becoming completely different.</p>
   <p>Windows is permanently stuck on having to explicitly detail that its implementation is "16-bit, UCS-2 as per the standard", before explicitly informing developers to use vendor-specific <code class="highlight"><c- n>WideCharToMultibyte</c-></code>/<code class="highlight"><c- n>MultibyteToWideChar</c-></code> to handle UTF16-encoded characters in <code class="highlight"><c- b>wchar_t</c-></code>.</p>
   <p>These solutions provide ways to achieve a local maxima for a specific vendor or platform. Unfortunately, this comes at the extreme cost of portability: the code has no guarantee it will work anywhere but your machine, and in a world that is increasingly interconnected by devices that interface with networks it makes sharing both data and code troublesome and hard to work with.</p>
   <h3 class="heading settled" data-level="2.2" id="intro-problem-what"><span class="secno">2.2. </span><span class="content">Problem 2: What is the Encoding?</span><a class="self-link" href="#intro-problem-what"></a></h3>
   <p>With <code class="highlight"><c- n>setlocale</c-></code> and <code class="highlight"><c- n>getlocale</c-></code> only responding to and returning implementation-defined <code class="highlight"><c- p>(</c-><c- k>const</c-> <c- p>)</c-><c- b>char</c-><c- o>*</c-></code>, there is no way to portably determine what the locale (and any associated encoding) should or should not be. The typical solution for this has been to code and program only for what is guaranteed by the Standard as what is in the Basic Character Set. While this works fine for source code itself, this produces an extremely hostile environment:</p>
   <ul>
    <li data-md>
     <p>conversion functions in the standard mangle and truncate data in (sometimes troubling, sometimes hilarious) fashion;</p>
    <li data-md>
     <p>programs which are not careful to meticulously track encoding of incoming text often lose the ability to understand that text;</p>
    <li data-md>
     <p>programmers can never trust the platform will support even the Latin characters in any representation of data beyond the 7th bit of a byte;</p>
    <li data-md>
     <p>and, interchange between cultures with different default encodings makes it impossible to communicate with others without entirely forsaking the standard library.</p>
   </ul>
   <p>Abandoning the C <strong>Standard</strong> Library -- to get <strong>standard</strong> behavior across platforms -- is an exceedingly bitter pill to have to swallow as an enthusiastic C developer.</p>
   <h3 class="heading settled" data-level="2.3" id="intro-problem-performance"><span class="secno">2.3. </span><span class="content">Problem 3: Performance</span><a class="self-link" href="#intro-problem-performance"></a></h3>
   <p>The current version of the C Standard includes functions which attempt to alleviate Problems 1 and 2 by providing conversions from the per-process (and sometimes per-thread), locale-sensitive black box encoding of multibyte <code class="highlight"><c- b>char</c-><c- o>*</c-></code> strings. They do this by providing conversions to <code class="highlight"><c- n>char16_t</c-></code> units or <code class="highlight"><c- n>char32_t</c-></code> units with <code class="highlight"><c- n>mbrtoc</c-><c- p>(</c-><c- mi>16</c-><c- o>|</c-><c- mi>32</c-><c- p>)</c-></code> and <code class="highlight"><c- n>c</c-><c- p>(</c-><c- mi>16</c-><c- o>|</c-><c- mi>32</c-><c- p>)</c-><c- n>rtomb</c-></code> functions. We will for a brief moment ignore the presence of the <code class="highlight"><c- n>__STD_C_UTF16__</c-></code> and <code class="highlight"><c- n>__STD_C_UTF32__</c-></code> macros and assume the two types mean that string literals and library functions convert to and from UTF16 and UTF32 respectively. We will also ignore that <code class="highlight"><c- b>wchar_t</c-></code>’s encoding -- which is just as locale-sensitive and unknown at compile and runtime as <code class="highlight"><c- b>char</c-></code>’s encoding is -- has no such conversion functions. These givens make it possible to say that we, as C programmers, have 2 known encodings which we can use to shepherd data into a stable state for manipulation and processing as library developers.</p>
   <p>Even with that knowledge, these one-unit-at-a-time conversions functions are slower than they should be.</p>
   <p>On many platforms, these one-at-a-time function calls come from the operating system, dynamically loaded libraries, or other places which otherwise inhibit compiler observation and optimizer inspection. Attempts to vectorize code or unroll loops built around these functions is thoroughly thwarted by this. Building static libraries or from source is very often a non-starter for many platforms. Since the encoding used for multibyte strings and wide strings are controlled by the implementation, it becomes increasingly difficult to provide the functionality to convert long segments of data with decent performance characteristics without needing to opt into vendor or platform specific tricks.</p>
   <h3 class="heading settled" data-level="2.4" id="intro-problem-roundtrip"><span class="secno">2.4. </span><span class="content">Problem 4: <code class="highlight"><c- b>wchar_t</c-></code> Cannot Roundtrip</span><a class="self-link" href="#intro-problem-roundtrip"></a></h3>
   <p>With no <code class="highlight"><c- n>wctoc32</c-></code> or <code class="highlight"><c- n>wctoc16</c-></code> functions, the only way to convert a wide character or wide character string to a program-controlled, statically known encoding UTF encoding is to first invoke the wide character to multibyte function, and then invoke the multibyte function to either <code class="highlight"><c- n>char16_t</c-></code> or <code class="highlight"><c- n>char32_t</c-></code>.</p>
   <p>This means that even if we have a well-behaved <code class="highlight"><c- b>wchar_t</c-></code> that is not sensitive to the locale (e.g., on Windows machines), we lose data if the locale-controlled <code class="highlight"><c- b>char</c-></code> encoding is not set to something that can handle all incoming code unit sequences. The locale-based encoding in a program can thus tank what is simply meant to be a pass-through encoding from <code class="highlight"><c- b>wchar_t</c-></code> to <code class="highlight"><c- n>char16_t</c-></code>/<code class="highlight"><c- n>char32_t</c-></code>, all because the only Standards-compliant conversion channels data through the locale-based multibyte encoding <code class="highlight"><c- n>mb</c-><c- p>(</c-><c- n>s</c-><c- p>)(</c-><c- n>r</c-><c- p>)</c-><c- n>toX</c-><c- p>(</c-><c- n>s</c-><c- p>)</c-></code> functions.</p>
   <p>For example, it was fundamentally impossible to engage in a successful conversion from <code class="highlight"><c- b>wchar_t</c-></code> strings to <code class="highlight"><c- b>char</c-></code> multibyte strings on Windows using the C Standard Library. Until a very recent Windows 10 update, UTF8 could <strong>not</strong> be set as the active system codepage either programmatically or through an experimental, deeply-buried setting. This has changed with Windows Version 1903 (May 2019 Update), but the problems do not stop there.</p>
   <p>No dedicated UTF-8 support (the standard mandates no specific encodings or charsets) leaves developers to write the routines themselves. Worse, roundtrip through the locale after forcing a change to a UTF-8 locale may not be supported, leaving the developer to use the combination of functions to hope that the multibyte locale encoding is good enough to transfer data from the Unicode encodings to the wide character encodings (and vice-versa). While the non-restartable functions can save quite a bit of code size, unfortunately there are many encodings which are not as nice and require state to be processed correctly (e.g., Shift JIS and other ISO-2022 encodings). Not being able to retain that state between potential calls in a <code class="highlight"><c- b>mbstate_t</c-></code> is detrimental to the ability to move forward with any encoding endeavor that wishes to bridge the gap between these disparate platform encodings and the current locale.</p>
   <p>Because other library functions can be used to change or alter the locale in some manner, it once again becomes impossible to have a portable, compliant program with deterministic behavior if just one library changes the locale of the program, let alone if the encoding or locale is unexpected by the developer because they do not know of that culture or its locale setting. This hidden state is nearly impossible to account for: the result is software systems that cannot properly handle text in a meaningful way without abandoning C’s encoding facilities, relying on vendor-specific extensions/encodings/tools, or confining one’s program to only the 7-bit plane of existence.</p>
   <h3 class="heading settled" data-level="2.5" id="intro-problem-standard"><span class="secno">2.5. </span><span class="content">Problem 5: The C Standard Cannot Handle Existing Practice</span><a class="self-link" href="#intro-problem-standard"></a></h3>
   <p>The C standard does not allow a wide variety of encodings that implementations have already crammed into their backing locale blocks to work, resulting in the abandonment of locale-related text facilities by those with double-byte character sets, primarily from East Asia. For example, there is a serious bug that cannot be fixed without <a data-link-type="biblio" href="#biblio-glibc-25744" title="`mbrtowc` with Big5-HKSCS returns 2 instead of 1 when consuming the second byte of certain double byte characters">non-conforming, broken behavior</a>:</p>
   <blockquote>
    <p>...</p>
    <p>This call writes the second Unicode code point, but does not consume
any input. 0 is returned since no input is consumed. According to
the C standard, a return of 0 is reserved for when a null character is
written, but since the C standard doesn’t acknowledge the existence of
characters that can’t be represented in a single <code class="highlight"><c- b>wchar_t</c-></code>, we’re already
operating outside the scope of the standard.</p>
   </blockquote>
   <p>The standard cannot handle encodings that must return two or more <code class="highlight"><c- b>wchar_t</c-></code> for however many -- up to <code class="highlight"><c- n>MB_MAX_LEN</c-></code> -- <code class="highlight"><c- b>char</c-></code>s it consumes. This is even for when the target <code class="highlight"><c- b>wchar_t</c-></code> "wide execution" encoding is UTF-32; this is a <strong>fundamental limitation of the C Standard Library that is absolutely insurmountable by the current specification</strong>. This is exacerbated by the standard’s insistence that a single <code class="highlight"><c- b>wchar_t</c-></code> must be capable of representing all characters as a single element, a philosophy which has been bled into the relevant interfaces such as <code class="highlight"><c- n>mbrtowc</c-></code> and other <code class="highlight"><c- o>*</c-><c- n>wc</c-><c- o>*</c-></code> related types. As the values cannot be properly represented in the standard, this leaves people to either make stuff up or abandon it altogether. This <a data-link-type="biblio" href="#biblio-n1570" title="C11 Committee Draft">means that the design introduced from C11</a> and beyond is fundamentally broken when it comes to handling existing practice.</p>
   <p>Furthermore, clarification requests have had to be filed for other functions, <a data-link-type="biblio" href="#biblio-n2244" title="Clarification Request Summary for C11, Version 1.13">just to improve their behavior with respect to multiple input and multiple output</a>. Many have been noted as issues for <code class="highlight"><c- n>mbrtoc16</c-></code> and similar functionality, as was originally part of <a data-link-type="biblio" href="#biblio-n2282" title="Additional multibyte/wide string conversion functions">Dr. Philip K. Krause’s fixes to the functions</a>. This paper attempts to solve the same problem in a more fundamental manner.</p>
   <h3 class="heading settled" data-level="2.6" id="intro-summary"><span class="secno">2.6. </span><span class="content">In Summary</span><a class="self-link" href="#intro-summary"></a></h3>
   <p>The problems C developers face today with respect to encoding and dealing with vendor and platform-specific black boxes is a staggering trifecta: non-portability between processes running on the same physical hardware, performance degradation from using standard facilities, and potentially having a locale changed out from under your program to prevent roundtripping.</p>
   <p>This serves as the core motivation for this proposal.</p>
   <h2 class="heading settled" data-level="3" id="prior"><span class="secno">3. </span><span class="content">Prior Art</span><a class="self-link" href="#prior"></a></h2>
   <p>There are many sources of prior art for the desired feature set. Some functions (with fixes) were implemented directly in implementations, embedded and otherwise. Others rely exclusively platform-specific code in both Windows and POSIX implementations. Others have cross-platform libraries that work across a myriad of platforms, such as ICU or iconv. We discuss the most diverse and exemplary implementations.</p>
   <h3 class="heading settled" data-level="3.1" id="prior-standard"><span class="secno">3.1. </span><span class="content">Standard C</span><a class="self-link" href="#prior-standard"></a></h3>
   <p>To understand what this paper proposes, an explanation of the current landscape is necessary. The below table is meant to be read as being <code class="highlight"><c- p>{</c-><c- n>row</c-><c- p>}</c-><c- n>to</c-><c- p>{</c-><c- n>column</c-><c- p>}</c-></code>. The symbols provide the following information:</p>
   <ul>
    <li data-md>
     <p>✔️: Function exists in both its restartable (function name has the indicative <code class="highlight"><c- n>r</c-></code> in it) and its canonical non-restartable form (<code class="highlight"><c- p>{</c-><c- n>row</c-><c- p>}</c-><c- n>to</c-><c- p>{</c-><c- n>column</c-><c- p>}</c-></code> and <code class="highlight"><c- p>{</c-><c- n>row</c-><c- p>}</c-><c- n>rto</c-><c- p>{</c-><c- n>column</c-><c- p>}</c-></code>).</p>
    <li data-md>
     <p>🇷: Function exists only in its "restartable" form (<code class="highlight"><c- p>{</c-><c- n>row</c-><c- p>}</c-><c- n>rto</c-><c- p>{</c-><c- n>column</c-><c- p>}</c-></code>).</p>
    <li data-md>
     <p>❌: Function does not exist at all.</p>
   </ul>
   <p>Here is what exists in the C Standard Library so far:</p>
   <table class="feature-emoji">
    <tbody>
     <tr>
      <th class="feature-emoji-cell">
      <th class="feature-emoji-cell"><code class="highlight"><c- n>mb</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>wc</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>mbs</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>wcs</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c8</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c16</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c32</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c8s</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c16s</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c32s</c-></code>
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>mb</c-></code>
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell"> 🇷 
      <td class="feature-emoji-cell">🇷
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>wc</c-></code>
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>mbs</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>wcs</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c8</c-></code>
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c16</c-></code>
      <td class="feature-emoji-cell">🇷
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c32</c-></code>
      <td class="feature-emoji-cell">🇷
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c8s</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌<br>
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c16s</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">➖
      <td class="feature-emoji-cell">❌
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c32s</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">❌
      <td class="feature-emoji-cell">➖
   </table>
   <p>There is a lot of missing functionality here in this table, and it is important to note that a large amount of this comes from both not being willing to standardize more than the bare minimum and not having a cohesive vision for improving encoding conversions in the C Standard. Notably, string-based <code class="highlight"><c- p>{</c-><c- n>prefix</c-><c- p>}</c-><c- n>s</c-></code> functions are missing, leaving performance-oriented multi-unit conversions out of the standard. There are also severe API flaws in the C standard, <a href="#intro-problem-standard">as discussed above</a>.</p>
   <h3 class="heading settled" data-level="3.2" id="prior-win32"><span class="secno">3.2. </span><span class="content">Win32</span><a class="self-link" href="#prior-win32"></a></h3>
   <p><code class="highlight"><c- n>WideCharToMultiByte</c-></code> and <code class="highlight"><c- n>MultiByteToWideChar</c-></code> are the APIs of choice for those in Win32 environments to get to and from the run-time execution encoding and -- if it matches -- the translation-time execution encoding. Unfortunately, these APIs are locked within the Windows ecosystem entirely as they are not available as a standalone library. Furthermore, as an operating system Windows exclusively controls what it can and cannot convert from and to; some of these functions power the underlying portions of the character conversion functions in their Standard Library, but they notably truncate multi-code-unit characters for their UTF-16 <code class="highlight"><c- b>wchar_t</c-></code>. This produces a broken, deprecated UCS-2 encoding when e.g. <code class="highlight"><c- n>mbrtowc</c-></code> is used instead of directly relying on the operating system functionality, making the C standard’s functions of dubious use.</p>
   <h3 class="heading settled" data-level="3.3" id="prior-nl_langinfo"><span class="secno">3.3. </span><span class="content"><code class="highlight"><c- n>nl_langinfo</c-></code></span><a class="self-link" href="#prior-nl_langinfo"></a></h3>
   <p><code class="highlight"><c- n>nl_langinfo</c-></code> is a POSIX function that returns various pieces of information based on an enumerated input and some extra parameters. It has been suggested that this be standardized over anything else, to make it easier to determine what to do with a given locale.</p>
   <p>The first problem with this is it returns a string-based identifier that can be whatever an implementation decides it should be. This makes <code class="highlight"><c- n>nl_langinfo</c-></code> is no better than <code class="highlight"><c- n>setlocale</c-><c- p>(</c-><c- n>LC_CHARSET</c-><c- p>,</c-> NULL<c- p>)</c-></code> in its design:</p>
   <blockquote>
    <p>Specifies the name of the coded character set for which the <strong>charmap</strong> file is defined. This value determines the value returned by the <code class="highlight"><c- n>nl_langinfo</c-></code> subroutine. The <code class="highlight"><c- o>&lt;</c-><c- n>code_set_name</c-><c- o>></c-></code> must be specified using any character from the portable character set, except for control and space characters.</p>
   </blockquote>
   <p>Any name can be chosen that fits this description, and POSIX nails nothing down for portability or identification reasons. There is no canonical list, just whatever implementations happen to supply as their "charmap" definitions.</p>
   <h3 class="heading settled" data-level="3.4" id="prior-sdcc"><span class="secno">3.4. </span><span class="content">SDCC</span><a class="self-link" href="#prior-sdcc"></a></h3>
   <p>The Small Device C Compiler (SDCC) has already begun some of this work. One of its principle contributors, Dr. Philip K. Krause, <a data-link-type="biblio" href="#biblio-n2282" title="Additional multibyte/wide string conversion functions">wrote papers addressing exactly this problem</a>. Krause’s work focuses entirely on non-restartable conversions from Multibyte Strings to <code class="highlight"><c- n>char16_t</c-></code> and <code class="highlight"><c- n>char32_t</c-></code>. There is no need for a conversion to a UTF8 <code class="highlight"><c- b>char</c-></code> style string for SDCC, since the Multibyte String in SDCC is always UTF8. This means that <code class="highlight"><c- n>mbstoc16s</c-></code> and <code class="highlight"><c- n>mbstoc32s</c-></code> and the "reverse direction" functions encompass an entire ecosystem of UTF8, UTF16, and UTF32.</p>
   <p>While this is good for SDCC, this is not quite enough for other developers who attempt to write code in a cross-platform manner.</p>
   <p>Nevertheless, SDCC’s work is still important: it demonstrates that these functions are implementable, even for small devices. With additional work being done to implement them for other platforms, there is strong evidence that this can be implemented in a cross-platform manner and thusly is suitable for the Standard Library.</p>
   <h3 class="heading settled" data-level="3.5" id="prior-iconv"><span class="secno">3.5. </span><span class="content">iconv/ICU</span><a class="self-link" href="#prior-iconv"></a></h3>
   <p>The C functions presented below is motivated primarily by concepts found in a popular POSIX library, <a data-link-type="biblio" href="#biblio-iconv" title="libiconv">[iconv]</a>. We do not provide the full power of iconv here but we do mimic its interface to allow for a better definition of functions, as explained in <a href="#intro-problem-standard">Problem 5</a>. The core of the functionality can be embodied in this parameterized function signature:</p>
<pre class="language-cpp highlight"><c- n>stdc_mcerr</c-> <c- nf>XstoYs</c-><c- p>(</c-><c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_bytes</c-><c- p>,</c-> <c- k>const</c-> <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c-> <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_bytes</c-><c- p>);</c->
</pre>
   <p>In <code class="highlight"><c- n>iconv</c-></code>’s case, an additional first parameter describing the conversion (of type <code class="highlight"><c- n>iconv_t</c-></code>). That is not needed for this proposal, because we are not making a generic conversion API. This proposal is focused on doing 2 things and doing them extremely well:</p>
   <ul>
    <li data-md>
     <p>Getting data from the current execution encoding (<code class="highlight"><c- b>char</c-></code>) to a Unicode encoding (<code class="highlight"><c- n>char8_t</c-></code>/UTF-8, <code class="highlight"><c- n>char16_t</c-></code>/UTF-16, <code class="highlight"><c- n>char32_t</c-></code>/UTF-32), and the reverse.</p>
    <li data-md>
     <p>Getting data from the current wide execution encoding (<code class="highlight"><c- b>wchar_t</c-></code>) to a Unicode encoding (<code class="highlight"><c- n>char8_t</c-></code>/UTF-8, <code class="highlight"><c- n>char16_t</c-></code>/UTF-16, <code class="highlight"><c- n>char32_t</c-></code>/UTF-32), and the reverse.</p>
   </ul>
   <p>iconv can do the above conversions, but also supports a complete list of pairwise conversions between about 49 different encodings. It can also be extended at translation time by programming more functionality into its library. This proposal is focusing just in doing conversions to and from encodings that the implementation owns to/from Unicode. This results in the design found <a href="#wording">below</a>.</p>
   <div class="pagebreak"></div>
   <h2 class="heading settled" data-level="4" id="design"><span class="secno">4. </span><span class="content">Design</span><a class="self-link" href="#design"></a></h2>
   <p>Given the problems before, the prior art, the implementation experience, and the vendor experience, it is clear that we need something outside of <code class="highlight"><c- n>nl_langinfo</c-></code>, lighter weight than all of <code class="highlight"><c- n>iconv</c-></code>, and more resilient and encompassing than what the C Standard offers. Therefore, the solution to our problem of having a wide variety of implementation encodings is to expand the contract of <code class="highlight"><c- b>wchar_t</c-></code> for an <strong>entirely new set of functions</strong> which avoid the problems and pitfalls of the old mechanism.</p>
   <p>Notably, both of the multibyte string’s function design and the wide character string’s definition of a single character is broken in terms of existing practice today. The primary problem relies in the inability for both APIs in either direction to handle <code class="highlight"><c- nl>N</c-><c- p>:</c-><c- n>M</c-></code> encodings, rather than <code class="highlight"><c- nl>N</c-><c- p>:</c-><c- mi>1</c-></code> or <code class="highlight"><c- mi>1</c-><c- o>:</c-><c- n>M</c-></code>. Therefore, these new functions focus on providing an interface to allow multi-code-unit conversions, in both directions.</p>
   <p>To facilitate this, a new header -- <code class="highlight"><c- o>&lt;</c-><c- n>stdmchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> -- is introduced. The header contains the "multi character" (<code class="highlight"><c- n>mc</c-></code>) and "multi wide character" (<code class="highlight"><c- n>mwc</c-></code>) conversion routines, respectively. To support getting lossless data out of <code class="highlight"><c- b>wchar_t</c-></code> and <code class="highlight"><c- b>char</c-></code> strings controlled firmly by the implementation -- and back into those types if the code units in the characters are supported -- the following functionality is proposed using the new multi (wide) character (<code class="highlight"><c- n>m</c-><c- p>[</c-><c- n>w</c-><c- p>]</c-><c- n>c</c-></code>) prefixes and suffixes:</p>
   <table class="feature-emoji">
    <tbody>
     <tr>
      <th class="feature-emoji-cell">
      <th class="feature-emoji-cell"><code class="highlight"><c- n>mc</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>mwc</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>mcs</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>mwcs</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c8</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c16</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c32</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c8s</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c16s</c-></code>
      <th class="feature-emoji-cell"><code class="highlight"><c- n>c32s</c-></code>
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>mc</c-></code>
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>mwc</c-></code>
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>mcs</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>mwcs</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c8</c-></code>
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c16</c-></code>
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c32</c-></code>
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c8s</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c16s</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
     <tr>
      <td class="feature-emoji-cell"><code class="highlight"><c- n>c32s</c-></code>
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
      <td class="feature-emoji-cell">🅿️✔️
   </table>
   <p>In particular, it is imperative to recognize that the implementation is the "sole proprietor" of the wide locale encodings and multibyte locale encodings for its string literals (compiler) and library functions (standard library). Therefore, the <code class="highlight"><c- n>mc</c-></code> and <code class="highlight"><c- n>mwc</c-></code> functions simply focus on providing a good interface for these encodings. The form of both the individual and string conversion functions are:</p>
<pre class="language-cpp highlight"><c- n>stdc_mcerr</c-> <c- nf>stdc_XnrtoYn</c-><c- p>(</c-><c- k>const</c-> <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c-> <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_XsnrtoYsn</c-><c- p>(</c-><c- k>const</c-> <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c-> <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
</pre>
   <p>The input and output sizes are expressed in terms of the # of <code class="highlight"><c- n>charX</c-></code>/<code class="highlight"><c- n>charY</c-></code>s. They take the input/output sizes as pointers, and decrement the value by the amount of input/output consumed. Similarly, the input/output data pointers themselves are incremented by the amount of spaces consumed / written to. This only happens when an irreversible and successful conversion of input data can successfully and without error be written to the output. The <code class="highlight"><c- n>s</c-></code> functions work on whole strings rather than just a single complete irreversible conversion, the <code class="highlight"><c- n>n</c-></code> stands for taking a size value.</p>
   <p>Input is consumed and output is written (with sizes updated) in accordance with a single, successful computation of an <em>indivisible unit of work</em>. An indivisible unit of work is the smallest set of input that can be consumed that produces no error and guarantees forward progress through either the input or output buffer (most of the time, both). No output is guaranteed to occur (e.g., during the consumption of a shift state mechanism for e.g. SHIFT-JIS), but if output does happen then it only occurs upon the successful completion of an indivisible unit of work.</p>
   <p>If an error happens, the conversion is stopped and an error code is returned. The function does not decrement the input or output sizes for the failed operation, nor does it shift the input and output pointers forward for the failed operation. "Failed operation" refers to a single, indivisible unit of work. The error codes are as follows:</p>
   <ul>
    <li data-md>
     <p><code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-> <c- o>=</c-> <c- mi>-3</c-></code> - the input is correct but there is not enough output space</p>
    <li data-md>
     <p><code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-> <c- o>=</c-> <c- mi>-2</c-></code> - an incomplete input was found after exhausting the input</p>
    <li data-md>
     <p><code class="highlight"><c- n>stdc_mcerr_invalid</c-> <c- o>=</c-> <c- mi>-1</c-></code> - an encoding error occurred</p>
    <li data-md>
     <p><code class="highlight"><c- n>stdc_mcerr_ok</c-> <c- o>=</c-> <c- mi>0</c-></code> - the operation was successful</p>
   </ul>
   <p>The behaviors are as follows:</p>
   <ul>
    <li data-md>
     <p>if <code class="highlight"><c- n>state</c-></code> is a null pointer, then:</p>
     <ul>
      <li data-md>
       <p>an automatic storage duration (non-<code class="highlight"><c- k>static</c-></code>) <code class="highlight"><c- b>mbstate_t</c-></code> object is initialized to the initial conversion state;</p>
      <li data-md>
       <p>and, a pointer to this state object plus the original four parameters are passed to the function.</p>
     </ul>
    <li data-md>
     <p>if <code class="highlight"><c- n>output</c-></code> is a null pointer or <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is a null pointer, then no output will be written. If <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> is not a null pointer, the value will be decremented the amount of characters that would have been written.</p>
    <li data-md>
     <p>if <code class="highlight"><c- n>output</c-></code> and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> are not null pointers, and <code class="highlight"><c- n>output_size</c-></code> is a null pointer, then enough space is assumed in the output buffer for the entire operation.</p>
    <li data-md>
     <p>if <code class="highlight"><c- n>input</c-></code> is a null pointer or <code class="highlight"><c- o>*</c-><c- n>input</c-></code> is a null pointer, then <code class="highlight"><c- n>state</c-></code> is set to the initial conversion state and, if <code class="highlight"><c- n>output</c-></code> is not a null pointer, will write out a sequence - if any - to represent a change to the initial conversion state. No other actions are performed. In all other cases, <code class="highlight"><c- n>input</c-></code> must not be a null pointer.</p>
   </ul>
   <p>Finally, it is useful to prevent the class of <code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-></code>/<code class="highlight"><c- mi>-3</c-></code> errors from showing up in your code if you know you have enough space. For the non-string (the functions lacking <code class="highlight"><c- n>s</c-></code>) that perform a single conversion, a user can pre-allocate a suitably sized static buffer in automatic storage duration space. This will be facilitated by a group of integral constant expressions contained in macros, which would be;</p>
   <ul>
    <li data-md>
     <p><code class="highlight"><c- n>STDC_MC_MAX</c-></code>, which is the maximum output for a call to one of the X to multi character functions</p>
    <li data-md>
     <p><code class="highlight"><c- n>STDC_MWC_MAX</c-></code>, which is the maximum output for a call to one of the X to multi wide character functions</p>
    <li data-md>
     <p><code class="highlight"><c- n>STDC_C8_MAX</c-></code>, which is the maximum output for a call to one of the X to UTF-8 character functions</p>
    <li data-md>
     <p><code class="highlight"><c- n>STDC_C16_MAX</c-></code>, which is the maximum output for a call to one of the X to UTF-16 character functions</p>
    <li data-md>
     <p><code class="highlight"><c- n>STDC_C32_MAX</c-></code>, which is the maximum output for a call to one of the X to UTF-32 character functions</p>
   </ul>
   <p>these values are suitable for use as the size of an array, allowing a properly sized buffer to hold all of the output from the non-string functions. These limits apply <strong>only</strong> to the non-string functions, which perform a single unit of irreversible input consumption and output (or fail with one of the error codes and outputs nothing).</p>
   <p>Here is the full list of proposed functions:</p>
<pre class="language-cpp highlight"><c- cp>#include</c-> &lt;stdmchar.h>

<c- cp>#define STDC_C8_MAX  4</c->
<c- cp>#define STDC_C16_MAX 2</c->
<c- cp>#define STDC_C32_MAX 1</c->
<c- cp>#define STDC_MC_MAX  1</c->
<c- cp>#define STDC_MWC_MAX 1</c->

<c- k>typedef</c-> <c- k>enum</c-> <c- nc>stdc_mcerr</c-> <c- p>{</c->
  <c- n>stdc_mcerr_ok</c->                  <c- o>=</c->  <c- mi>0</c-><c- p>,</c->
  <c- n>stdc_mcerr_invalid</c->             <c- o>=</c-> <c- mi>-1</c-><c- p>,</c->
  <c- n>stdc_mcerr_incomplete_input</c->    <c- o>=</c-> <c- mi>-2</c-><c- p>,</c->
  <c- n>stdc_mcerr_insufficient_output</c-> <c- o>=</c-> <c- mi>-3</c->
<c- p>}</c-> <c- n>stdc_mcerr</c-><c- p>;</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
</pre>
   <h3 class="heading settled" data-level="4.1" id="design-forms"><span class="secno">4.1. </span><span class="content">Which Function Form?</span><a class="self-link" href="#design-forms"></a></h3>
   <p>There are several different ways to write the functions present here, each with their own unique tradeoffs. Since a lot of calling conventions cannot afford struct parameters and returns by-value without elevating them to a level of indirection (filling in a pointer of an object allocated by the caller on the stack), and since much of the functionality of the standard does not follow such a convention, in this paper we simply evaluate the pointer and integer-based forms that will allow all parameters to be passed in registers or similar on most calling conventions we know of (including but not limited to arm7e, arm, arm64, amd64 (VC++ and System V), x86). From those requirements, the most prominent forms are:</p>
<pre class="language-cpp highlight"><c- c1>// (1)</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_XnrtoYn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- c1>// (2)</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_XnrtoYn</c-><c- p>(</c-><c- b>size_t</c-> <c- n>output_size</c-><c- p>,</c-> <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- c1>// (3)</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_XnrtoYn</c-><c- p>(</c-><c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c-> <c- k>const</c-> <c- n>charY</c-><c- o>*</c-> <c- n>output_last</c-><c- p>,</c->
  <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c-><c- k>const</c-> <c- n>charX</c-><c- o>*</c-> <c- n>input_last</c-><c- p>,</c-> 
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- c1>// (4)</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_XnrtoYn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charY</c-><c- o>*</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
</pre>
   <p>The form of (1) is what is in this paper and the form that this paper started out with. It is what we are going to move forward with for this proposal. It is similar to <code class="highlight"><c- n>iconv</c-></code>, but deviates from that design a bit by using the typical Win32 and similar convention that a null pointer argument changes the behavior to allow for greater flexibility. For example, passing <code class="highlight">NULL</code> to the first design for the <code class="highlight"><c- n>output_size</c-></code> allows an implementation to assume the output buffer is large enough: this can save on size checking on every successful conversion and write out. It also allows passing <code class="highlight">NULL</code> for <code class="highlight"><c- n>output</c-></code>, which allows an end-user to not perform any write outs but simply determine the full count of objects.</p>
   <p>As a negative, it requires writes through indirect pointers for both the input and output, as well as for the sizes for the input and output. This causes multiple updates to be necessary, and duplicates information in exchange for a moderate decrease in ease-of-use. U#fortunately, it turns out this form is actually necessary for all of the functionality proposed here.</p>
   <h4 class="heading settled" data-level="4.1.1" id="design-forms-state"><span class="secno">4.1.1. </span><span class="content"><code class="highlight"><c- b>mbstate_t</c-></code> Parameter for Unicode-only Conversions?</span><a class="self-link" href="#design-forms-state"></a></h4>
   <p>Because the Unicode conversions, as specified, require no intermediate holdings, there is technically no reason to provide the <code class="highlight"><c- b>mbstate_t</c-></code> parameter. However, macro-generic programming used to wrap this code may partially rely on having an additional parameter to pass to the function. There is currently no way to have a variable argument parameter in a macro reflected with <code class="highlight"><c- n>__VA_ARGS__</c-></code> without undefined behavior / implementation extensions, and solving such an issue would take even more advanced macro generic programming to solve the problem. Therefore, we keep the <code class="highlight"><c- b>mbstate_t</c-></code> parameter, noting that passing the state object or just simply passing <code class="highlight">NULL</code>/<code class="highlight"><c- mi>0</c-></code> all the time to such a parameter is a viable usage strategy. We realize this is not ideal but it is <a href="https://ztdcuneicode.readthedocs.io/en/latest/api/generic%20typed%20conversions.html#c.cnc_cxsnrtocysn">how it has been implemented in our code</a>.</p>
   <h4 class="heading settled" data-level="4.1.2" id="design-forms-simplify"><span class="secno">4.1.2. </span><span class="content">Simplification Without Loss of Functionality?</span><a class="self-link" href="#design-forms-simplify"></a></h4>
   <p>An attempt to fix this is done by utilizing the form in (2), which prevents giving the sizes as pointers but still has pointer-to-pointer values. Unfortunately for design (2), this means that it is impossible to perform a "counting" operation (just calculate the number of code units to write out or the number of input characters that will be consumed) without having a valid buffer to write data into, so that before/after pointer values for <code class="highlight"><c- n>output</c-></code> can be subtracted from one another.</p>
   <p>One could then try to smuggle the error code into the return value, albeit down that path is fraught with API design issues. One would need to exclude the values <code class="highlight"><c- mi>0</c-></code>, <code class="highlight"><c- mi>-1</c-></code>, <code class="highlight"><c- mi>-2</c-></code>, and <code class="highlight"><c- mi>-3</c-></code> from being used in return values, or some other set of arbitrary values. These are not good ideas and C users have struggled with APIs that behaved this way in the past: see the conversion functions currently in the C Standard which behave in this manner and obfuscate the return value for <code class="highlight"><c- mi>0</c-></code> (which still writes out a character but also indicates other actions performed) or the case of <code class="highlight"><c- mi>-3</c-></code> (where multiple write outs may need to happen so the function needs to be called again). These issues have also caused fundamental limitations in the C standard library, as present in <a data-link-type="biblio" href="#biblio-glibc-25744" title="`mbrtowc` with Big5-HKSCS returns 2 instead of 1 when consuming the second byte of certain double byte characters">[glibc-25744]</a>.</p>
   <p>Form (3) is simply a re-visitation of form (2), but using pointers to indicate the size. This is nominally fine, until subtraction between two pointers must be done. If <code class="highlight"><c- n>PTRDIFF_MAX</c-></code> is less than <code class="highlight"><c- n>SIZE_MAX</c-></code> and the architecture uses, for example, segmented memory, than it is possible to create a region of memory <code class="highlight"><c- n>SIZE_MAX</c-></code> that exceeds the size that can be understood from subtracting the leading pointers from the <code class="highlight"><c- o>*</c-><c- n>_last</c-></code> pointers. This is a mostly a theoretical concern on larger systems and hosted systems, but of much more grave concern on bare-metal machines with a tiny <code class="highlight"><c- n>PTRDIFF_MAX</c-></code>, or machines that make full use of the address space and frequently tap into paged memory.</p>
   <p>Finally, form (4) was the most attractive simplification. By keeping the indirect sizes but removing the double indirection from the input and output parameters, it presented a tempting bit of functionality that seemed to keep all of the benefits of form (1) but none of the drawbacks. That, unfortunately, does not apply in this one specific case for "unbounded writing":</p>
<pre class="language-cpp highlight"><c- n>stdc_mcerr</c-> <c- n>err</c-> <c- o>=</c-> <c- n>c8srntoc32sn</c-><c- p>(</c->NULL<c- p>,</c-> <c- n>some_utf32_buffer</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>input_sz</c-><c- p>,</c-> <c- n>some_utf8_input</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>state</c-><c- p>);</c->
</pre>
   <p>The above seems okay, until it becomes clear that you have no idea how many characters were written out into <code class="highlight"><c- n>some_utf32_buffer</c-></code>. By passing <code class="highlight">NULL</code> for the size but having no pointer to update, the information is lost entirely. One could argue that someone should call the version which does the counting first and THEN pass <code class="highlight">NULL</code> for the size, but this is overly restrictive. For example, a maximally-sized buffer can be prepared before hand when doing a UTF-8 to UTF-32 by simply assuming every code unit of input will result in one code point of output (e.g., everything input is ASCII). One could guarantee the fastest possible writing speed by creating such a maximally-sized buffer and then using <code class="highlight">NULL</code> for the size, but it would be impossible to know <strong>exactly</strong> how much output was written in that case. One could compromise the return value to return that information, but that brings up the same API design issues mentioned above. Therefore, we keep the double-pointer form to retain the information properly.</p>
   <h4 class="heading settled" data-level="4.1.3" id="design-forms-performance"><span class="secno">4.1.3. </span><span class="content">Performance of Double-Pointers?</span><a class="self-link" href="#design-forms-performance"></a></h4>
   <p>Benchmarks were inconclusive when it came to determining the cost of each API design. While writing out through (doubly-)indirect pointers provided a non-negligible cost when serializing all 2^<sup>~20.5</sup> available Unicode code points through a UTF-8 to UTF-32 conversion, these costs became noise values when bulk functions were written that did not simply invoke the single-conversion functions repeatedly. That is: it performed the logical equivalent of performing the bulk operation, and only updated the input/output pointers and sizes when it was finished with the operation.</p>
   <p>This could present a problem on at least one implementation, such as musl-libc. musl-libc both reportedly and in its implementation tends to implement their current bulk transcoding routines by simply looping over the single-unit transcoding routines. But, they have stated that they do not care about the performance degradation here and that they are perfectly fine with the cost of writing the bulk functions in terms of the single transcoding functions. As such, we find no reason to change the pointer-based design on the grounds of performance either.</p>
   <p>See additional information <a href="https://ztdtext.readthedocs.io/en/latest/benchmarks.html">at this benchmarking page</a>, particularly the <a href="https://ztdtext.readthedocs.io/en/latest/benchmarks/function%20form.html">function form</a> benchmarks and the <a href="https://ztdtext.readthedocs.io/en/latest/benchmarks/transcoding%20-%20UTF.html">transcoding benchmarks</a>.</p>
   <h4 class="heading settled" data-level="4.1.4" id="design-forms-struct"><span class="secno">4.1.4. </span><span class="content">Structure Returns?</span><a class="self-link" href="#design-forms-struct"></a></h4>
   <p>We do note that there could be a better interface design in general if the error value and other information were returned in a structure (the current input pointer, output pointer, and sizes-left). Then, we would not have to compromise the error return with a size and properly separate the two so that users do not accidentally misuse it as they have in the past. But, most places in the C Standard avoid using by-value structure returns. Therefore, this idea was, similarly, discarded.</p>
   <h4 class="heading settled" data-level="4.1.5" id="design-forms-choice"><span class="secno">4.1.5. </span><span class="content">Proposed Choice</span><a class="self-link" href="#design-forms-choice"></a></h4>
   <p>Given the above considerations about consistency with other functionality (no struct returns), the downsides of function forms (2)-(4), and the benchmark indications that the impact of doubly-indirect pointers is negligible in bulk, we therefore propose the double-pointer form, in order to retain the requisite information properly. Finally, we also added the <code class="highlight"><c- kr>restrict</c-></code> keyword to all pointers in the function signatures, in line with other functions currently in and proposed to the standard library.</p>
   <h3 class="heading settled" data-level="4.2" id="design-extension"><span class="secno">4.2. </span><span class="content">Extension Functions &amp; Methods (Building on top of this API)</span><a class="self-link" href="#design-extension"></a></h3>
   <p>We can achieve a better API for all of this by utilizing either Statement Expressions (the widely-implemented GCC extension that exists in tcc, Clang, many flavors of IBM Compiler, and more) as well as with Lambdas (as shown in <a data-link-type="biblio" href="#biblio-n2892" title="N2892: Basic lambdas for C">[n2892]</a>). For example, here is an API that, without providing new backing functions, is capable of reducing the number of indirections and taking parameters directly (<a href="https://github.com/soasis/cuneicode/blob/0d641dc8c5cd7619265b684021b0cafe6fae410b/examples/extensions/source/error_handling.utf32_to_utf8.stmt_exprs.c#L41-L46">implemented and deployed in the ztd.cuneicode library</a>):</p>
<pre class="language-cpp highlight"><c- cp>#include</c-> &lt;ztd/cuneicode.h>

<c- cp>#include</c-> &lt;ztd/idk/size.h>

<c- b>int</c-> <c- nf>main</c-><c- p>()</c-> <c- p>{</c->
  <c- c1>// This only works if we support extension functions!</c->
  <c- k>const</c-> <c- n>ztd_char32_t</c-> <c- n>input_data</c-><c- p>[]</c-> <c- o>=</c-> U<c- s>"Bark Bark Bark </c-><c- se>\xFFFF</c-><c- s>FFFF🐕‍🦺!"</c-><c- p>;</c->
  <c- n>ztd_char8_t</c-> <c- n>output_data</c-><c- p>[</c-><c- n>ztdc_c_array_size</c-><c- p>(</c-><c- n>input_data</c-><c- p>)</c-> <c- o>*</c-> <c- n>CNC_C8_MAX</c-><c- p>]</c-> <c- o>=</c-> <c- p>{</c-> <c- mi>0</c-> <c- p>};</c->
  <c- n>cnc_mcstate_t</c-> <c- n>state</c->                                                 <c- o>=</c-> <c- p>{</c-> <c- mi>0</c-> <c- p>};</c->
  <c- n>cnc_c32c8_error_result_t</c-> <c- n>err_result</c-> <c- o>=</c-> <c- n>cnc_cxsrtocysn_into_with_handler</c-><c- p>(</c->
       <c- n>ztdc_c_array_size</c-><c- p>(</c-><c- n>output_data</c-><c- p>),</c-> <c- n>output_data</c-><c- p>,</c-> <c- n>input_data</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>state</c-><c- p>,</c->
       <c- n>cnc_skip_input_and_replace_error</c-><c- p>,</c-> NULL<c- p>);</c->
  <c- c1>// …</c->
<c- p>}</c->
</pre>
   <p>Here, we see that we only need to take the <code class="highlight"><c- n>cnc_mcstate_t</c-></code> (analogous to this proposal’s <code class="highlight"><c- b>mbstate_t</c-></code>) parameter by pointer. The rest of the arguments (the <code class="highlight"><c- b>size_t</c-></code> for the data). This example even shows using an error handler function, with a <code class="highlight">NULL</code>-provided <code class="highlight"><c- b>void</c-><c- o>*</c-> <c- n>userdata</c-></code> for said error handler, to skip over bad input and replace it with the typical "unknown character" diamond seen in many places ("�", U+FFFD REPLACEMNT CHARACTER).</p>
   <p>The API presented in this paper is the most basic and fundamental API that enables all of these use cases without loss of generality, and that is why we are focused on providing it to the C Standard. Extension methods utilizing statement expressions or lambdas in combination with macro generic programming will be able to provide additional functionality without forcing implementations to add more symbols to their symbol table.</p>
   <p><strong class="advisement"> Note that, due to C’s lack of strong type safety for its core typedefs like <code class="highlight"><c- b>wchar_t</c-></code> or <code class="highlight"><c- n>char16_t</c-></code>, these type-based generic programming bits can be brittle. For example, on Windows machines using the Clang compiler, both <code class="highlight"><c- b>wchar_t</c-></code> and <code class="highlight"><c- n>char16_t</c-></code> are the same type (<code class="highlight"><c- b>unsigned</c-> <c- b>short</c-></code>). A <code class="highlight"><c- k>_Generic</c-></code>-based switch for types will either make a compiler error if both <code class="highlight"><c- b>wchar_t</c-></code> and <code class="highlight"><c- n>char16_t</c-></code> are used in the same switch, or fall into the "wrong" function because it is impossible to differentiate between the two types. This is further reason why the Extension Functions should be left out of this proposal and for a later time.</strong></p>
   <h3 class="heading settled" data-level="4.3" id="design-wchar_t"><span class="secno">4.3. </span><span class="content"><code class="highlight"><c- b>wchar_t</c-></code> and Existing practice</span><a class="self-link" href="#design-wchar_t"></a></h3>
   <p><code class="highlight"><c- b>wchar_t</c-></code> and wide characters in general have a requirement placed on them in the definition section that every character supported in the wide execution encoding (and wide literal encoding) must be fully representable as a <strong>single</strong> <code class="highlight"><c- b>wchar_t</c-></code> value. This has not matched existing practice for the last ~20 or so years, and has produced specification issues with functions such as <code class="highlight"><c- n>mbrtowc</c-></code>, which does not have a sequence of return values that can adequately represent e.g. Big5-HKSCS needing to output 2 different UTF-32 code points for some of its input characters (4 specific input sequences of them result in two UTF-32 code point outputs, to be precise).</p>
   <p>Part of this proposal removes the wording that makes this requirement. Because this is an expansion of privileges and not a shrinking, it conflicts with no existing implementation that was already working around this requirement or arbitrarily restricting their C Standard Library functionality to handle this (some *BSD-based platforms, some IBM-vended platforms, all Microsoft platforms).</p>
   <p>As explained in <a href="#intro-problem-standard">§ 2.5 Problem 5: The C Standard Cannot Handle Existing Practice</a>, this has been a long-standing issue in C and C++, but has particularly struck the C implementations due to the wording and setup of these types. Therefore, it would be extraordinarily expedient to remove the requirement and do as this proposal does, which is provide additional functionality to cover the fundamentally incompatible ABI and API — as well as user expectations — for the existing functions.</p>
   <p>C++ has adopted identical changes to the one in this proposal here in Corentin Jabot’s <a data-link-type="biblio" href="#biblio-p2460r2" title="Relax requirements on wchar_t to match existing practices">[p2460r2]</a>.</p>
   <p>As part of coping with these changes, implementations are offered 9 new macros, 6 predefined in the compiler and three in the standard library header <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> to reflect the new existing situation:</p>
   <ul>
    <li data-md>
     <p><code class="highlight"><c- n>__STDC_LITERAL_UTF8__</c-></code>, which is a predefined compiler macro describing whether the literal encoding (the compile-time <code class="highlight"><c- s>""</c-></code> string literal encoding) is ISO 10646 UTF-8 compliant (each element of the string is a single UTF-8 code unit).</p>
    <li data-md>
     <p><code class="highlight"><c- n>__STDC_LITERAL_UTF16__</c-></code>, which is a predefined compiler macro describing whether the literal encoding (the compile-time <code class="highlight"><c- s>""</c-></code> string literal encoding) is ISO 10646 UTF-16 compliant (each element of the string is a single UTF-16 code unit).</p>
    <li data-md>
     <p><code class="highlight"><c- n>__STDC_LITERAL_UTF32__</c-></code>, which is a predefined compiler macro describing whether the literal encoding (the compile-time <code class="highlight"><c- s>""</c-></code> string literal encoding) is ISO 10646 UTF-32 compliant (each element of the string is a single UTF-32 code unit).</p>
    <li data-md>
     <p><code class="highlight"><c- n>__STDC_WIDE_LITERAL_UTF8__</c-></code>, which is a predefined compiler macro describing whether the wide literal encoding (the compile-time <code class="highlight">L<c- s>""</c-></code> string literal encoding) is UTF-16 compliant (each element of the string is a single UTF-8 code unit).</p>
    <li data-md>
     <p><code class="highlight"><c- n>__STDC_WIDE_LITERAL_UTF16__</c-></code>, which is a predefined compiler macro describing whether the wide literal encoding (the compile-time <code class="highlight">L<c- s>""</c-></code> string literal encoding) is UTF-16 compliant (each element of the string is a single UTF-16 code unit).</p>
    <li data-md>
     <p><code class="highlight"><c- n>__STDC_WIDE_LITERAL_UTF32__</c-></code>, which is a predefined compiler macro describing whether the wide literal encoding (the compile-time <code class="highlight">L<c- s>""</c-></code> string literal encoding) is UTF-32 compliant (each element of the string is a single UTF-32 code unit).</p>
    <li data-md>
     <p><code class="highlight"><c- n>WCHAR_UTF8</c-></code>, which is a non-constant expression, that has a non-zero value if the <strong>wide execution</strong> encoding (the runtime encoding associated with <code class="highlight"><c- n>mbrtowc</c-></code>, <code class="highlight"><c- n>wcrtomb</c-></code>, and similar functions) is ISO 10646 compliant for UTF-8. Because this is a runtime check, it can handle the inherently runtime nature of this without compromising the compiler.</p>
    <li data-md>
     <p><code class="highlight"><c- n>WCHAR_UTF16</c-></code>, which is a non-constant expression, that has a non-zero value if the <strong>wide execution</strong> encoding (the runtime encoding associated with <code class="highlight"><c- n>mbrtowc</c-></code>, <code class="highlight"><c- n>wcrtomb</c-></code>, and similar functions) is ISO 10646 compliant for UTF-16. Because this is a runtime check, it can handle the inherently runtime nature of this without compromising the compiler.</p>
    <li data-md>
     <p><code class="highlight"><c- n>WCHAR_UTF32</c-></code>, which is a non-constant expression, that has a non-zero value if the <strong>wide execution</strong> encoding (the runtime encoding associated with <code class="highlight"><c- n>mbrtowc</c-></code>, <code class="highlight"><c- n>wcrtomb</c-></code>, and similar functions) is ISO 10646 compliant for UTF-32. Because this is a runtime check, it can handle the inherently runtime nature of this without compromising the compiler.</p>
    <li data-md>
     <p><code class="highlight"><c- n>MB_UTF8</c-></code>, which is a non-constant expression, that has a non-zero value if the <strong>execution</strong> encoding (the runtime encoding associated with <code class="highlight"><c- n>mbrtowc</c-></code>, <code class="highlight"><c- n>wcrtomb</c-></code>, and similar functions) is ISO 10646 compliant for UTF-8. Because this is a runtime check, it can handle the inherently runtime nature of this without compromising the compiler.</p>
    <li data-md>
     <p><code class="highlight"><c- n>MB_UTF16</c-></code>, which is a non-constant expression, that has a non-zero value if the <strong>execution</strong> encoding (the runtime encoding associated with <code class="highlight"><c- n>mbrtowc</c-></code>, <code class="highlight"><c- n>wcrtomb</c-></code>, and similar functions) is ISO 10646 compliant for UTF-16. Because this is a runtime check, it can handle the inherently runtime nature of this without compromising the compiler.</p>
    <li data-md>
     <p><code class="highlight"><c- n>MB_UTF32</c-></code>, which is a non-constant expression, that has a non-zero value if the <strong>execution</strong> encoding (the runtime encoding associated with <code class="highlight"><c- n>mbrtowc</c-></code>, <code class="highlight"><c- n>wcrtomb</c-></code>, and similar functions) is ISO 10646 compliant for UTF-32. Because this is a runtime check, it can handle the inherently runtime nature of this without compromising the compiler.</p>
   </ul>
   <p>These changes are necessary because, as Clang implementers have pointed out in various issues against their compiler (such as <a data-link-type="biblio" href="#biblio-clang-iso10646" title="Define __STDC_ISO_10646__">this one</a>), they cannot know before-hand whether or not the compiler can predefine this because the standard has mixed both execution encoding (execution time) and literal encoding (translation time) into the same macro, and asks the compiler to predefine it. An execution time property cannot be provably ascertained by the compiler ahead of time.</p>
   <p>GCC and other platforms work around this by using a special, internal, implementation-defined mechanism such as <code class="highlight"><c- n>stdc</c-><c- o>-</c-><c- n>predef</c-><c- p>.</c-><c- n>h</c-></code>, where they collect a number of environment macros and then use them to provide enhanced compile-time information. Clang does not have the same powers right now and so, in a completely conforming manner, simply shuts off the macro despite the information it providing being very useful on a myriad of platforms.</p>
   <p>By separating the literal encoding macros into new <code class="highlight"><c- n>__STDC_</c-><c- p>(</c-><c- n>WIDE_</c-><c- p>)</c-><c- n>LITERAL_UTF</c-><c- p>(</c-><c- mi>8</c-><c- o>/</c-><c- mi>16</c-><c- o>/</c-><c- mi>32</c-><c- p>)</c-><c- n>__</c-></code> parts, and leaving the <code class="highlight"><c- n>__STDC_ISO10646__</c-></code> macro to represent a <strong>potential</strong> interpretation of both translation and execution time behavior, we give the user more actionable information and prevent split compiler/library implementations like Clang from needing special knowledge to provide useful information. We also allow implementations to provide the information at runtime, which -- especially for large strings -- can provide sufficiently actionable information that even doing the check at runtime can give significant performance improvements. (UTF-32 based encoding and decoding routines are often very heavily optimized, as compared to generic locale-based conversion routines in not only C and C++ implementations, but routines underlying Haskell, Go, and other programming languages. See the work in Daniel Lemire’s <a data-link-type="biblio" href="#biblio-lemire-spire2021" title="Unicode at Gigabytes per Second">[lemire-spire2021]</a>.)</p>
   <p>No changes are needed to <code class="highlight"><c- n>__STDC_MB_MIGHT_NEQ_WC__</c-></code> because the specification for this macro already deliberately refers to using a basic character set value "… as the line character in an integer character constant" (§6.10.9.2, ¶1, <a data-link-type="biblio" href="#biblio-n3054" title="n3054: ISO/IEC 9899:202x - Programming Languages, C">[n3054]</a>). Therefore, the only change to this predefined macro is in its description where it applies directly to the literal <strong>AND</strong> wide literal encodings, rather than only one.</p>
   <p>These changes strengthen C’s legacy as a language suitable for powerful string processing.</p>
   <h2 class="heading settled" data-level="5" id="conclusion"><span class="secno">5. </span><span class="content">Conclusion</span><a class="self-link" href="#conclusion"></a></h2>
   <p>The ecosystem deserves ways to get to a statically-known encoding and not rely on implementation and locale-parameterized encodings. This allows developers a way to perform cross-platform text processing without needing to go through fantastic gymnastics to support different languages and platforms. An independent library implementation, <em>cuneicode</em> (talked about from <a data-link-type="biblio" href="#biblio-unicode_greater_detail" title="Catching ⬆️: Unicode for C++ in Greater Detail">Meeting C++</a> and <a data-link-type="biblio" href="#biblio-unicode_deep_c_diving" title="Deep C Diving - Fast and Scalable Text Interfaces at the Bottom">C++ On Sea</a>), is now <a data-link-type="biblio" href="#biblio-cuneicode" title="cuneicode - A spicy text library for C">publicly available to everyone</a>.</p>
   <h2 class="heading settled" data-level="6" id="wording"><span class="secno">6. </span><span class="content">Proposed Wording</span><a class="self-link" href="#wording"></a></h2>
   <p>The following wording is <a data-link-type="biblio" href="#biblio-n3054" title="n3054: ISO/IEC 9899:202x - Programming Languages, C">relative to n3054</a>.</p>
   <h3 class="heading settled" data-level="6.1" id="wording-intent"><span class="secno">6.1. </span><span class="content">Intent</span><a class="self-link" href="#wording-intent"></a></h3>
   <p>The intent of the wording is to provide transcoding functions that:</p>
   <ul>
    <li data-md>
     <p>define "code unit" as the smallest piece of information;</p>
    <li data-md>
     <p>define the notion of an "indivisible unit of work";</p>
    <li data-md>
     <p>remove the requirement that wide characters must represent a full, complete unit for all wide execution encodings that exist on the machine as they do not today;</p>
    <li data-md>
     <p>introduce the notion of multi-unit work that does not use the same 1:N or M:1 design as the precious <code class="highlight"><c- b>wchar_t</c-></code> functions;</p>
    <li data-md>
     <p>introduce new macros that allow for a programmer to tell the difference between</p>
    <li data-md>
     <p>convert from the execution ("<code class="highlight"><c- n>mc</c-></code>") and wide execution ("<code class="highlight"><c- n>mwc</c-></code>") encodings to the Unicode ("<code class="highlight"><c- n>c8</c-></code>", "<code class="highlight"><c- n>c16</c-></code>", "<code class="highlight"><c- n>c32</c-></code>") encodings and vice-versa;</p>
    <li data-md>
     <p>convert from the execution ("<code class="highlight"><c- n>mc</c-></code>") encoding to the wide execution ("<code class="highlight"><c- n>mwc</c-></code>") encoding and vice-versa;</p>
    <li data-md>
     <p>provide a way for <code class="highlight"><c- b>mbstate_t</c-></code> to be properly initialized as the initial conversion state; and,</p>
    <li data-md>
     <p>to be entirely thread-safe by default with no magic internal state asides from what is already required by locales.</p>
   </ul>
   <h3 class="heading settled" data-level="6.2" id="wording-specification"><span class="secno">6.2. </span><span class="content">Proposed Specification</span><a class="self-link" href="#wording-specification"></a></h3>
   <p><em>Author’s Note: Any � or ✨ is a stand-in character to be replaced by the editor.</em></p>
   <h4 class="heading settled" data-level="6.2.1" id="wording-specification-3.7.3"><span class="secno">6.2.1. </span><span class="content">Modify §3.7.3 Wide Character to change the definition to remove the one-to-one correspondence</span><a class="self-link" href="#wording-specification-3.7.3"></a></h4>
   <blockquote>
    <div> … </div>
    <div class="wording-clause-header"> <span class="wording-clause-number">3.7.3</span> <span class="wording-clause-title"></span> </div>
    <div class="wording-section">
     <div class="wording-numbered">
      <p><strong>wide character</strong></p>
      <p>
       value representable by an object of type <code class="highlight"><c- b>wchar_t</c-></code>
       <del>, capable of representing any character in the
current locale</del>
      </p>
     </div>
    </div>
    <div> … </div>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.2" id="wording-specification-6.10.9.2"><span class="secno">6.2.2. </span><span class="content">Modify §6.10.9.2 Environment Macros to add new wide literal-only predefined macro</span><a class="self-link" href="#wording-specification-6.10.9.2"></a></h4>
   <blockquote>
    <div class="wording-clause-header"> <span class="wording-clause-number">6.10.9.2</span> <span class="wording-clause-title">Environment Macros</span> </div>
    <div class="wording-section">
     <div class="wording-numbered">
      <p>The following are unspecified:</p>
      <dl>
       <dd data-md>
        <p><code class="highlight"><c- n>__STDC_ISO_10646__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>199712L</c-></code>). If this symbol is defined, then every character in the Unicode required set, when stored in an object of type <code class="highlight"><c- b>wchar_t</c-></code>, has the same value as the short identifier of that character. The Unicode required set consists of all the characters that are defined by ISO/IEC 10646, along with all amendments and technical corrigenda, as of the specified year and month. If some other encoding is used, the macro shall not be defined and the actual encoding used is implementation-defined.</p>
       <dd data-md>
        <ins><code class="highlight"><c- n>__STDC_LITERAL_UTF8__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>202012L</c-></code>). If this symbol is defined, then the literal encoding (6.2.9) is capable of storing every character in the Unicode required set and every sequence of <code class="highlight"><c- b>char</c-></code> from a string literal (excluding non-Universal character escape sequences) forms a valid encoding of UTF-8 sequence.</ins>
       <dd data-md>
        <ins><code class="highlight"><c- n>__STDC_LITERAL_UTF16__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>202012L</c-></code>). If this symbol is defined, then the literal encoding (6.2.9) is capable of storing every character in the Unicode required set and every sequence of <code class="highlight"><c- b>char</c-></code> from a string literal (excluding non-Universal character escape sequences) forms a valid encoding of UTF-16 sequence.</ins>
       <dd data-md>
        <ins><code class="highlight"><c- n>__STDC_LITERAL_UTF32__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>202012L</c-></code>). If this symbol is defined, then the literal encoding (6.2.9) is capable of storing every character in the Unicode required set and every sequence of <code class="highlight"><c- b>char</c-></code> from a string literal (excluding non-Universal character escape sequences) forms a valid encoding of UTF-32 sequence.</ins>
       <dd data-md>
        <ins><code class="highlight"><c- n>__STDC_WIDE_LITERAL_UTF8__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>202012L</c-></code>). If this symbol is defined, then the wide literal encoding (6.2.9) is capable of storing every character in the Unicode required set and every sequence of <code class="highlight"><c- n>w_chart</c-></code> from a <code class="highlight"><c- b>wchar_t</c-></code> string literal (excluding non-Universal character escape sequences) forms a valid encoding of UTF-8 sequence.</ins>
       <dd data-md>
        <ins><code class="highlight"><c- n>__STDC_WIDE_LITERAL_UTF16__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>202012L</c-></code>). If this symbol is defined, then the wide literal encoding (6.2.9) is capable of storing every character in the Unicode required set and every sequence of <code class="highlight"><c- b>wchar_t</c-></code> from a <code class="highlight"><c- b>wchar_t</c-></code> string literal (excluding non-Universal character escape sequences) forms a valid encoding of UTF-16 sequence.</ins>
       <dd data-md>
        <ins><code class="highlight"><c- n>__STDC_WIDE_LITERAL_UTF32__</c-></code> An integer constant of the form <code class="highlight"><c- n>yyyymmL</c-></code> (for example, <code class="highlight"><c- mf>202012L</c-></code>). If this symbol is defined, then the wide literal encoding (6.2.9) is capable of storing every character in the Unicode required set and every sequence of <code class="highlight"><c- b>wchar_t</c-></code> from a <code class="highlight"><c- b>wchar_t</c-></code> string literal (excluding non-Universal character escape sequences) forms a valid encoding of a UTF-32 sequence.</ins>
       <dd data-md>
        <p>
         <code class="highlight"><c- n>__STDC_MB_MIGHT_NEQ_WC__</c-></code> The integer constant <code class="highlight"><c- mi>1</c-></code>, intended to indicate that, in the 
         <ins>wide literal </ins>
         encoding for <code class="highlight"><c- b>wchar_t</c-></code>, a member of the basic character set need not have a code value equal to its value when used as the lone character in an integer character constant.
        </p>
      </dl>
     </div>
    </div>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.3" id="wording-specification-7.21"><span class="secno">6.2.3. </span><span class="content">Modify §7.21 Common Definitions <code class="highlight"><c- o>&lt;</c-><c- n>stddef</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> to Remove Harmful <code class="highlight"><c- b>wchar_t</c-></code> Text</span><a class="self-link" href="#wording-specification-7.21"></a></h4>
   <blockquote>
    <div class="wording-clause-header"> <span class="wording-clause-number">7.21</span> <span class="wording-clause-title">Common definitions <code class="highlight"><c- n>stddef</c-><c- p>.</c-><c- n>h</c-></code></span> </div>
    <div class="wording-section">
     <div> … </div>
     <div class="wording-numbered wording-numbered-2">
      <p>The types are …</p>
      <p>… which is an object type whose alignment is the greatest fundamental alignment;</p>
<pre class="language-cpp highlight"><c- b>wchar_t</c->
</pre>
      <p>
       which is an integer type whose range of values can represent 
       <del>distinct codes for all members of the largest extended character set specified among the supported locales;</del>
       <ins>codes for all the members of the all supported wide execution encodings (6.2.9);</ins>
        the null character shall have the code value zero. Each member of the basic character set shall have a code value equal to its value when used as the lone character in an integer character constant if an implementation does not define <code class="highlight"><c- n>__STDC_MB_MIGHT_NEQ_WC__</c-></code>; and,
      </p>
     </div>
    </div>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.4" id="wording-specification-7.31"><span class="secno">6.2.4. </span><span class="content">Modify §7.31 Extended Multibyte and Wide Character Utilities <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> to Clarify Role of <code class="highlight"><c- b>wchar_t</c-></code></span><a class="self-link" href="#wording-specification-7.31"></a></h4>
   <blockquote>
    <div class="wording-clause-header"> <span class="wording-clause-number">7.31</span> <span class="wording-clause-title">Environment Macros</span> </div>
    <div class="wording-clause-header"> <span class="wording-clause-number">7.31.1</span> <span class="wording-clause-title">Introduction</span> </div>
    <div class="wording-section">
     <div class="wording-numbered">
       The header <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> defines 
      <del>four</del>
      <ins>several</ins>
       macros, and declares four data types, one tag, and many functions. 
     </div>
     <div> … </div>
     <div class="wording-numbered wording-numbered-3">
      <p>
       The macros defined are <code class="highlight">NULL</code> (described in 7.21); <code class="highlight"><c- n>WCHAR_MIN</c-></code>, <code class="highlight"><c- n>WCHAR_MAX</c-></code>, and <code class="highlight"><c- n>WCHAR_WIDTH</c-></code> (de-
scribed in 7.22)
       <ins>;</ins>
      </p>
      <ins>
<pre class="language-cpp highlight"><c- n>WCHAR_UTF8</c->
<c- n>WCHAR_UTF16</c->
<c- n>WCHAR_UTF32</c->
</pre>
      </ins>
      <ins>
       which expand to an expression of signed or unsigned integer type whose value is non-zero if: 
       <ul>
        <li data-md>
         <p>the wide execution encoding (6.2.9) is capable of representing every character in the required Unicode set;</p>
        <li data-md>
         <p>the width of <code class="highlight"><c- b>wchar_t</c-></code> is at least 8, 16, or 32 for UTF-8, UTF-16, or UTF-32, respectively;</p>
        <li data-md>
         <p>and, the values of a sequence of <code class="highlight"><c- b>wchar_t</c-></code> objects consumed and produced by related character functions have a values consistent with a sequence of code units of the UTF-8, UTF-16, or UTF-32 encodings, respectively.</p>
       </ul>
      </ins>
      <ins>
<pre class="language-cpp highlight"><c- n>MB_UTF8</c->
<c- n>MB_UTF16</c->
<c- n>MB_UTF32</c->
</pre>
      </ins>
      <ins>
       which expand to an expression of signed or unsigned integer type whose value is non-zero if: 
       <ul>
        <li data-md>
         <p>the execution encoding (6.2.9) is capable of representing every character in the required Unicode set;</p>
        <li data-md>
         <p>the width of <code class="highlight"><c- b>char</c-></code> is at least 8, 16, or 32 for UTF-8, UTF-16, or UTF-32, respectively;</p>
        <li data-md>
         <p>and, the values of a sequence of <code class="highlight"><c- b>char</c-></code> objects consumed and produced by related character functions have a values consistent with a sequence of code units of the UTF-8, UTF-16, or UTF-32 encodings, respectively;</p>
       </ul>
      </ins>
       and, 
<pre class="language-cpp highlight"><c- n>WEOF</c->
</pre>
      <p>which expands to a …</p>
     </div>
    </div>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.5" id="wording-specification-6.2.9"><span class="secno">6.2.5. </span><span class="content">Modify §6.2.9 Encodings to include definitions of Code Point, Code Unit, Wide/Narrow Execution Encodings, and Encoding Error</span><a class="self-link" href="#wording-specification-6.2.9"></a></h4>
   <blockquote>
    <div class="wording-clause-header"> <span class="wording-clause-number">6.2.9</span> <span class="wording-clause-title">Encodings</span> </div>
    <div class="wording-section">
     <div class="wording-numbered wording-numbered-1"> … </div>
     <div class="wording-numbered wording-numbered-2"> … </div>
     <ins>
      <div class="wording-numbered wording-numbered-3">
       <p>A <em>code unit</em> is a single compositional unit of encoded information, usually of type <code class="highlight"><c- b>char</c-></code>, <code class="highlight"><c- n>char8_t</c-></code>, <code class="highlight"><c- n>char16_t</c-></code>, <code class="highlight"><c- n>char32_t</c-></code>, or <code class="highlight"><c- b>wchar_t</c-></code>.</p>
      </div>
      <div class="wording-numbered">
       <p>A <em>code point</em> is a single compositional unit of decoded information. Code points are generally used as the single complete decoded output, or as an intermediary to transcode to other code units. A <em>Unicode code point</em> is a single compositional unit of decoded information as defined in ISO/IEC 10646, typically used to convert to or from UTF-8, UTF-16, and UTF-32.</p>
      </div>
      <div class="wording-numbered">
       <p>The <em>narrow execution encoding</em> is the implementation-defined, <code class="highlight"><c- n>LC_CTYPE</c-></code>, (7.11.1)-influenced, locale-based execution environment encoding. The <em>wide execution encoding</em> is the implementation-defined, <code class="highlight"><c- n>LC_CTYPE</c-></code> (7.11.1)-influenced, locale-based wide execution environment encoding. Both of these encodings are called the <em>execution encodings</em>.</p>
      </div>
      <div class="wording-numbered wording-numbered-6">
       <p>An <em>unrecorded encoding error</em> occurs when an encoding, decoding, or transcoding function encounters an input sequence of code units or code points that</p>
       <dl>
        <dd data-md>
         <p>— does not form a valid sequence according to the encoding being associated with the sequence, or</p>
        <dd data-md>
         <p>— is not representable in the output encoding or coded character set.</p>
       </dl>
      </div>
      <div class="wording-numbered">
       <p>An <em>encoding error</em> is the same as an unrecorded encoding error, except that the value of the macro <code class="highlight"><c- n>EILSEQ</c-></code> (7.5) is stored in <code class="highlight"><c- n>errno</c-></code> when such an error occurs during execution of the functions defined in this document unless otherwise specified.</p>
      </div>
     </ins>
    </div>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.6" id="wording-specification-7.21.3"><span class="secno">6.2.6. </span><span class="content">Modify §7.21.3 Files to remove the italics from the term "encoding error", since it’s initial definition was moved to §6.2.9 Encodings</span><a class="self-link" href="#wording-specification-7.21.3"></a></h4>
   <blockquote>
    <div class="wording-clause-header"> <span class="wording-clause-number">7.21.3</span> <span class="wording-clause-title">Files</span> </div>
    <div class="wording-section">
     <div class="wording-numbered wording-numbered-1"> … </div>
     <div class="wording-numbered wording-numbered-14">
      <p>
       An 
       <del><em>encoding error</em></del>
       <ins>encoding error</ins>
        occurs if the character sequence presented to the underlying <code class="highlight"><c- n>mbrtowc</c-></code> function does not form a valid (generalized) multibyte character, or if the code value passed to the underlying <code class="highlight"><c- n>wcrtomb</c-></code> does not correspond to a valid (generalized) multibyte character. The wide character input/output functions and the byte input/output functions store the value of the macro <code class="highlight"><c- n>EILSEQ</c-></code> in <code class="highlight"><c- n>errno</c-></code> if and only if an encoding error occurs.
      </p>
     </div>
    </div>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.7" id="wording-specification-7.S✨"><span class="secno">6.2.7. </span><span class="content">Create a new section §7.S✨ and §7.S✨.1 Text Transcoding Utilities</span><a class="self-link" href="#wording-specification-7.S✨"></a></h4>
   <blockquote>
    <ins>
     <div class="wording-clause-header"> <span class="wording-clause-number">7.S✨</span> <span class="wording-clause-title">Text transcoding utilities <code class="highlight"><c- o>&lt;</c-><c- n>stdmchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code></span> </div>
     <div class="wording-clause-header"> <span class="wording-clause-number">7.S✨.1</span> <span class="wording-clause-title">General</span> </div>
     <div class="wording-section">
      <div class="wording-numbered">
       <p>The header <code class="highlight"><c- o>&lt;</c-><c- n>stdmchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> declares four status code enumerators, five macros, several types and several functions for transcoding encoded text safely and efficiently. It is meant to supersede conversion utilities from Unicode utilities (7.28) and Extended multibyte and wide character utilities (7.29). It is meant to represent "multi character" functions. These functions can be used to count the number of input that form a complete sequence, count the number of output characters required for a conversion with no additional allocation, validate an input sequence, or transcode text from one encoding to another encoding. Particularly, it provides single unit and multi unit transcoding functions for transcoding by working on <em>code units</em> and <em>code points</em>.</p>
      </div>
      <div class="wording-numbered">
       <p>Inputs to the functions in this clause are read until there is enough information taken in to perform an <em>indivisible unit of work</em>. An indivisible unit is the smallest possible input, as defined by the encoding, that can produce one or more outputs, perform a transformation of any state, or both. The conversion of these indivisible units is called an indivisible unit of work, and they are used to complete the transcoding operations specified below.</p>
      </div>
      <div class="wording-numbered">
        One or more of the following must hold for any given transcoding operation on an attempt to complete an indivisible unit of work: 
       <dl>
        <dd data-md>
         <p>— enough input is consumed to perform an output or change the state;</p>
        <dd data-md>
         <p>— output is written from consuming input, or output is written from the state which causes the state to change; or,</p>
        <dd data-md>
         <p>— an error occurs and both the input and output do not change relative to the current indivisible unit of work.</p>
       </dl>
       <p>For the multi unit functions, the process acts as if it completes one indivisible unit of work repeatedly. When an error occurs, only the input successfully consumed, the state successfully altered, and the output successfully written according to the last indivisible unit of work are reflected in the output values of the functions in this clause: no other values are written.</p>
      </div>
      <div class="wording-numbered">
       <p>Functions in <code class="highlight"><c- o>&lt;</c-><c- n>stdmchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> which use <code class="highlight"><c- b>char</c-></code> and <code class="highlight"><c- b>wchar_t</c-></code>, or their qualified forms, derive their implementation-defined encodings from the narrow execution encoding or the wide execution encoding (6.2.9), respectively. The other encodings are UTF-8, associated with <code class="highlight"><c- n>char8_t</c-></code>, UTF-16, associated with <code class="highlight"><c- n>char16_t</c-></code>, and UTF-32, associated with <code class="highlight"><c- n>char32_t</c-></code>.<span class="footnote-ref">FN✨0)</span></p>
      </div>
      <div> <span class="footnote-ref">FN✨0)</span> <span class="footnote">Each value is treated as code units and not as a container of octets. This means that the decision of, for example, UTF-16 in big or little endian encoding scheme is decided by the endianness of the code unit type. Only whole code unit values are used, i.e., a UTF-32 code point value of U+1F377 represents a value identical to how <code class="highlight"><c- n>U</c->'<c- n>\U0001F377</c->'</code> is stored by the implementation. This requirement does not apply to the implementation-defined literal, wide literal, narrow execution, and wide execution encodings, but does apply to the Unicode encodings.</span> </div>
       <br> 
      <div class="wording-numbered">
       <p>For the UTF-8, UTF-16, and UTF-32 encodings, collectively referred to as the <em>Unicode encodings</em>, an indivisible unit of work for a read operation shall be the sequence of code units that corresponds to one Unicode code point. If input is exhausted before a sequence of code units corresponding to one code point can be reached, then <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code> shall be returned. If there is an illegal code unit sequence, then <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code> shall be returned.<span class="footnote-ref">FN✨1)</span> For the implementation-defined execution and wide execution encodings, they have the same aforementioned requirement if the implementation defines it to be one of the Unicode encodings.<span class="footnote-ref">FN✨2)</span></p>
      </div>
      <div class="wording-numbered">
       <p>For all functions in this clause, when the equivalent of a <code class="highlight"><c- sc>'\0'</c-></code> (a code unit value of 0) is encountered in the input, the <code class="highlight"><c- b>mbstate_t</c-></code> object in use for the transcoding operation is set to the initial shift state<span class="footnote-ref">FN✨3)</span>. The output associated with the indivisible unit of work consists of the appropriate null character preceded by any shift sequence necessary to cause the output to be in the initial shift state.</p>
      </div>
      <div> <span class="footnote-ref">FN✨1)</span><span class="footnote"> For example, if an implementation chooses to provide a UTF-8 execution encoding as the input encoding, then it is required to read one full complete code point’s worth of code units. If it cannot, it shall return <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code> (if the input sequence is not long enough but does not have any invalid code units in the sequence) or <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code> (if the input sequence is not a proper UTF-8 code unit sequence).</span> </div>
       <br> 
      <div> <span class="footnote-ref">FN✨2)</span><span class="footnote"> This requirement does not apply to derivative encodings defined by the implementation. For example, an implementation may define a "partial UTF-8" execution encoding where it stores every read UTF-8 code unit in the state and, rather than returning <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code>, returns <code class="highlight"><c- n>stdc_mcerr_ok</c-></code> and produces no output. It may accumulate code units and write out a code point when it accumulated enough code units in its internal state. However, such an encoding is distinct and separate from the UTF-8 encoding used in the <code class="highlight"><c- n>c8</c-></code> prefixed and suffixed functions.</span> </div>
       <br> 
      <div> <span class="footnote-ref">FN✨3)</span><span class="footnote"> As described in 7.30.6, an object of type <code class="highlight"><c- b>mbstate_t</c-></code> may always be set to the initial conversion sequence by initializing it with <code class="highlight"><c- o>=</c-> <c- p>{</c-><c- mi>0</c-><c- p>};</c-></code> or <code class="highlight"><c- o>=</c-> <c- p>{};</c-></code>. An existing <code class="highlight"><c- b>mbstate_t</c-></code> object may always be set to the initial conversion sequence by assigning to it from the expressions <code class="highlight"><c- p>(</c-><c- b>mbstate_t</c-><c- p>){</c-><c- mi>0</c-><c- p>}</c-></code> or <code class="highlight"><c- p>(</c-><c- b>mbstate_t</c-><c- p>){}</c-></code>.</span> </div>
      <p><br></p>
      <div class="wording-numbered">
       <p>Changing the <code class="highlight"><c- n>LC_CTYPE</c-></code> category causes any conversion state already in use with the functions in this clause to be indeterminate.</p>
      </div>
      <div class="wording-numbered">
       <p>The types declared are <code class="highlight"><c- b>mbstate_t</c-></code> (described in 7.29.1), <code class="highlight"><c- b>wchar_t</c-></code> (described in 7.19), <code class="highlight"><c- n>char8_t</c-></code> (described in 7.28), <code class="highlight"><c- n>char16_t</c-></code> (described in 7.28), <code class="highlight"><c- n>char32_t</c-></code> (described in 7.28), <code class="highlight"><c- b>size_t</c-></code> (described in 7.19), and;</p>
       <blockquote>
<pre class="language-cpp highlight"><c- n>stdc_mcerr</c->
</pre>
       </blockquote>
       <p>which is both an enumerated type and a typedef whose enumerators identify the status codes from a function calls described in this clause.</p>
      </div>
      <div class="wording-numbered">
        The five macros declared are 
       <blockquote>
<pre class="language-cpp highlight"><c- n>STDC_C8_MAX</c->
<c- n>STDC_C16_MAX</c->
<c- n>STDC_C32_MAX</c->
<c- n>STDC_MC_MAX</c->
<c- n>STDC_MWC_MAX</c->
</pre>
       </blockquote>
       <p>which correspond to the maximum output for each single unit conversion function (7.S✨.2) and its corresponding output type. Each macro shall expand into an integer constant expression with minimum values, as described in the following table.</p>
      </div>
      <div class="wording-numbered">
       <p>There is an association of naming convention, types, encoding, and maximums, used to describe the functions in this clause:</p>
       <table>
        <tbody>
         <tr>
          <th>Name
          <th>Code Unit Type
          <th>Encoding
          <th>Maximum Output Macro
          <th>Minimum Value
         <tr>
          <td>mc
          <td><code class="highlight"><c- b>char</c-></code>
          <td>The <i>narrow execution encoding</i>,<br>influenced by <code class="highlight"><c- n>LC_CTYPE</c-></code>
          <td><code class="highlight"><c- n>STDC_MC_MAX</c-></code>
          <td><code class="highlight"><c- mi>1</c-></code>
         <tr>
          <td>mwc
          <td><code class="highlight"><c- b>wchar_t</c-></code>
          <td>The <i>wide execution encoding</i>,<br>influenced by <code class="highlight"><c- n>LC_CTYPE</c-></code>
          <td><code class="highlight"><c- n>STDC_MWC_MAX</c-></code>
          <td><code class="highlight"><c- mi>1</c-></code>
         <tr>
          <td>c8
          <td><code class="highlight"><c- n>char8_t</c-></code>
          <td>UTF-8
          <td><code class="highlight"><c- n>STDC_C8_MAX</c-></code>
          <td><code class="highlight"><c- mi>4</c-></code>
         <tr>
          <td>c16
          <td><code class="highlight"><c- n>char16_t</c-></code>
          <td>UTF-16
          <td><code class="highlight"><c- n>STDC_C16_MAX</c-></code>
          <td><code class="highlight"><c- mi>2</c-></code>
         <tr>
          <td>c32
          <td><code class="highlight"><c- n>char32_t</c-></code>
          <td>UTF-32
          <td><code class="highlight"><c- n>STDC_C32_MAX</c-></code>
          <td><code class="highlight"><c- mi>1</c-></code>
       </table>
       <p>The maximum output macro values specified in the above table are related to the single unit conversion functions (7.S✨.2). These functions perform at most one indivisible unit of work, or return an error. The maximum output macro values shall be integer constant expressions large enough that conversions to the single unit conversion function’s specified encoding shall not overflow a buffer of the proper code unit type with that size. The maximum output macro values do not affect the multi unit conversion functions (7.S✨.3), which perform as many indivisible units of work as is possible until an error occurs, until the output space is exhausted, or until the input is exhausted.</p>
      </div>
      <div class="wording-numbered">
       <p>Unlike the functions present in <code class="highlight"><c- o>&lt;</c-><c- n>uchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code> and <code class="highlight"><c- o>&lt;</c-><c- n>wchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code>, the functions present in this header can return multiple values for conversions based on <code class="highlight"><c- b>wchar_t</c-></code> to accommodate a wider set of implementation-defined encodings, so long as the number of code units does not exceed the maximum output macro value of <code class="highlight"><c- n>STDC_MWC_MAX</c-></code>.</p>
      </div>
      <div class="wording-numbered">
       <p>The enumerators of the enumerated type <code class="highlight"><c- n>stdc_mcerr</c-></code> are defined as follows:</p>
       <blockquote>
<pre class="language-cpp highlight"><c- n>stdc_mcerr_ok</c->                  <c- o>=</c->  <c- mi>0</c->
<c- n>stdc_mcerr_invalid</c->             <c- o>=</c-> <c- mi>-1</c-><c- p>,</c->
<c- n>stdc_mcerr_incomplete_input</c->    <c- o>=</c-> <c- mi>-2</c-><c- p>,</c->
<c- n>stdc_mcerr_insufficient_output</c-> <c- o>=</c-> <c- mi>-3</c-><c- p>,</c->
</pre>
       </blockquote>
       <p>Each value represents an specific situation when calling the relevant transcoding functions in <code class="highlight"><c- o>&lt;</c-><c- n>stdmchar</c-><c- p>.</c-><c- n>h</c-><c- o>></c-></code>:</p>
       <dl>
        <dd data-md>
         <p>— <code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-></code>, when the input is correct and an indivisible unit of work can be performed but there is not enough output space to write to;</p>
        <dd data-md>
         <p>— <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code>, when input has been exhausted and the sequence is not incorrect but there are no more input values;</p>
        <dd data-md>
         <p>— <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code>, when a unrecorded encoding error occurred; and,</p>
        <dd data-md>
         <p>— <code class="highlight"><c- n>stdc_mcerr_ok</c-></code>, when the operation was successful (none of the situations described for the other values of this enumerated type apply).</p>
       </dl>
       <p>No other value shall be returned from the functions described in this clause.</p>
      </div>
      <div class="wording-clause-section-title"> Recommended Practice </div>
      <div class="wording-numbered">
        The maximum output macro values are intended for use in making automatic storage duration array declarations. Implementations should choose values for the macros that are spacious enough to accommodate a variety of underlying implementation choices for the target encodings supported by the narrow execution encodings and wide execution encodings, which for some encodings can output more than one UTF-32 code point. Below is a set of values which are most resilient to future additions and changes in implementations: 
       <blockquote>
<pre class="language-cpp highlight"><c- cp>#define STDC_C8_MAX  32</c->
<c- cp>#define STDC_C16_MAX 16</c->
<c- cp>#define STDC_C32_MAX  8</c->
<c- cp>#define STDC_MC_MAX  32</c->
<c- cp>#define STDC_MWC_MAX 16</c->
</pre>
       </blockquote>
      </div>
      <div class="wording-numbered">
       <p>Beyond just the Unicode encodings mentioned above, implementations are encouraged to not store partial reads or partial writes in the <code class="highlight"><c- b>mbstate_t</c-></code> object with these functions unless as is strictly necessary. Implementations providing additional encodings for use with these functions should, to the extent possible for a given encoding, always define an indivisible unit of work to transcode as complete a unit of information as is possible or produce an error. If a sequence of code units cannot form a complete shift sequence or produce output, then an implementation should return <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code> if the input is exhausted, or <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code> if the input sequence is incorrect.</p>
      </div>
     </div>
    </ins>
   </blockquote>
   <blockquote>
    <ins>
     <h4 class="heading settled" data-level="6.2.8" id="wording-specification-7.S✨.2"><span class="secno">6.2.8. </span><span class="content">Create a new section §7.S✨.2 Single Unit Sized Conversion Functions</span><a class="self-link" href="#wording-specification-7.S✨.2"></a></h4>
     <div class="wording-clause-header"> <span class="wording-clause-number">7.S✨.2</span><span class="wording-clause-title">Single Unit Sized Conversion Functions</span> </div>
     <div class="wording-section">
      <div class="wording-clause-section-title"> Synopsis </div>
      <div class="wording-numbered">
       <blockquote>
<pre class="language-cpp highlight"><c- cp>#include</c-> &lt;stdmchar.h>

<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcnrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcnrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8nrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16nrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtomcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtomwcn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtoc8n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtoc16n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32nrtoc32n</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
</pre>
       </blockquote>
      </div>
      <div class="wording-clause-section-title"> Description </div>
      <div class="wording-numbered">
       <p>Let <em>transcoding function</em> be one of the functions listed above transcribed in the form</p>
<pre class="language-cpp highlight"><c- n>stdc_mcerr</c-> <c- n>stdc_XnrtoYn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
  <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>)</c->
</pre>
       <p>with the following properties:</p>
       <dl>
        <dd data-md>
         <p>— <em>X</em> and <em>Y</em> be one of the prefixes/suffixes in the table from 7.S✨.1;</p>
        <dd data-md>
         <p>— <i><code class="highlight"><c- n>charX</c-></code></i> and <i><code class="highlight"><c- n>charY</c-></code></i> be the associated code unit types for <em>X</em> and <em>Y</em> in the table from 7.S✨.1; and</p>
        <dd data-md>
         <p>— <em>encoding X</em> and <em>encoding Y</em> be the associated encoding types for <em>X</em> and <em>Y</em> in the table from 7.S✨.1.</p>
       </dl>
       <p>The transcoding functions take an input buffer and an output buffer of the associated code unit types, potentially with their sizes. The function consumes any number of code units of type <code class="highlight"><c- n>charX</c-></code> to perform a single indivisible unit of work necessary to convert some amount of input from encoding X to encoding Y, which results in zero or more output code units of type <code class="highlight"><c- n>charY</c-></code>.</p>
      </div>
      <div class="wording-numbered">
       <p>An <code class="highlight"><c- b>mbstate_t</c-></code> object assuredly describes the conversion state for the current conversion if it is not in an unspecified state (as described further below) and:</p>
       <dl>
        <dd data-md>
         <p>— the conversion is between Unicode encodings; or</p>
        <dd data-md>
         <p>— the input fragment is the start of an encoded sequence in the input encoding and the <code class="highlight"><c- b>mbstate_t</c-></code> object was initialized to the initial conversion state; or</p>
        <dd data-md>
         <p>— the input fragment is a continuation of an encoded sequence and <code class="highlight"><c- b>mbstate_t</c-></code> is the result of having advanced to the input and output positions through the application of prior calls to the same transcoding function.</p>
       </dl>
       <p>The behavior is undefined when a function described by this subclause is invoked and <code class="highlight"><c- o>*</c-><c- n>state</c-></code> (or, if <code class="highlight"><c- n>state</c-></code> is a null pointer, the <code class="highlight"><c- b>mbstate_t</c-></code> object created for that case) does not describe the conversion state for the current conversion.</p>
      </div>
      <div class="wording-numbered">
       <p>The transcoding functions convert from code units of type <code class="highlight"><c- n>charX</c-></code> interpreted according to encoding X to code units of type <code class="highlight"><c- n>charY</c-></code> according to encoding Y given a conversion state of value <code class="highlight"><c- o>*</c-><c- n>state</c-></code>. This function only performs a single indivisible unit of work. It returns <code class="highlight"><c- n>stdc_mcerr_ok</c-></code> if the input is empty. The input is considered empty if <code class="highlight"><c- n>input_size</c-></code> is a null pointer, or <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> is zero if <code class="highlight"><c- n>input_size</c-></code> is not a null pointer. The behavior of the transcoding functions is as follows.</p>
       <dl>
        <dd data-md>
         <p>— If <code class="highlight"><c- n>state</c-></code> is a null pointer, then an automatic storage duration object of type <code class="highlight"><c- b>mbstate_t</c-></code> is created which is unique to the current invocation. It is initialized to the initial conversion state and a pointer to this object is used wherever <code class="highlight"><c- n>state</c-></code> is used in this paragraph<span class="footnote-ref">FN✨4)</span>.</p>
        <dd data-md>
         <p>— If <code class="highlight"><c- n>input</c-></code> is a null pointer or <code class="highlight"><c- o>*</c-><c- n>input</c-></code> is a null pointer, then <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is set to the initial conversion state. If <code class="highlight"><c- n>output</c-></code> and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> are not null pointers, and if <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is not in the initial conversion state, it writes any necessary output to return the output sequence to the initial conversion state, unless <code class="highlight"><c- n>output_size</c-></code> is not a null pointer and there is not enough space to write that output. In the case where the output sequence is not written to because there is not enough space, <code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-></code> is returned. Otherwise, the function returns <code class="highlight"><c- n>stdc_mcerr_ok</c-></code> and if <code class="highlight"><c- n>output_size</c-></code> is not a null pointer then <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> is decremented by the amount of output written. If <code class="highlight"><c- n>output_size</c-></code> is a null pointer and <code class="highlight"><c- n>output</c-></code> and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> are not null pointers, then enough space to perform the write out is assumed; the behavior is undefined if the output buffer is not large enough for the transcoding operation in this case.</p>
        <dd data-md>
         <p>— The function reads code units from <code class="highlight"><c- o>*</c-><c- n>input</c-></code> if <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> is large enough to produce an indivisible unit of work. If no encoding errors have occurred but the input is exhausted before an indivisible unit of work can be computed, the function returns <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code>. If an unrecorded encoding error occurs, then the function returns <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code>.</p>
        <dd data-md>
         <p>— If <code class="highlight"><c- n>output_size</c-></code> is not a null pointer, then <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> will be decremented the amount of code units that would have been written to <code class="highlight"><c- o>*</c-><c- n>output</c-></code> (even if <code class="highlight"><c- n>output</c-></code> is a null pointer). If the output would be exhausted (<code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> will be decremented below zero by the write out of the indivisible unit of work), the function returns <code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-></code> and does not decrement <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code>.</p>
        <dd data-md>
         <p>— If <code class="highlight"><c- n>output</c-></code> or <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is a null pointer, then no output will be written. If applicable, <code class="highlight"><c- o>*</c-><c- n>input</c-></code> is still read and incremented. If <code class="highlight"><c- n>output_size</c-></code> is not a null pointer and both <code class="highlight"><c- n>output</c-></code> and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is not a null pointer, then <code class="highlight"><c- o>*</c-><c- n>output</c-></code> shall point to at least <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> <em>charY</em> code units.</p>
        <dd data-md>
         <p>— If <code class="highlight"><c- n>output_size</c-></code> is a null pointer, <code class="highlight"><c- n>output</c-></code> is not a null pointer, and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is not a null pointer, then enough space in the buffer pointed to by <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is assumed for the write out of the completed indivisible unit of work. The behavior is undefined if the output buffer is not large enough for the transcoding operation.</p>
       </dl>
      </div>
      <div class="wording-clause-section-title"> Returns </div>
      <div class="wording-numbered">
       <p>On success or failure, the transcoding functions shall return one of the above error codes (7.S✨.1). If <code class="highlight"><c- n>input</c-></code> is a null pointer or <code class="highlight"><c- o>*</c-><c- n>input</c-></code> is a null pointer, then <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is set to the initial conversion state as described below and no other work is performed.</p>
      </div>
      <div class="wording-numbered">
       <p>If the function returns <code class="highlight"><c- n>stdc_mcerr_ok</c-></code>, then all of the following is true:</p>
       <dl>
        <dd data-md>
         <p>— if <code class="highlight"><c- n>input</c-></code> and <code class="highlight"><c- o>*</c-><c- n>input</c-></code> are not null pointers, <code class="highlight"><c- o>*</c-><c- n>input</c-></code> is incremented by the number of code units read and successfully converted ;</p>
        <dd data-md>
         <p>— if <code class="highlight"><c- n>input_size</c-></code> is not a null pointer, <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> is decremented by the number of code units read and successfully converted from the input;</p>
        <dd data-md>
         <p>— if <code class="highlight"><c- n>output</c-></code> and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> are not null pointers, <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is incremented by the number of code units written to the output; and,</p>
        <dd data-md>
         <p>— if <code class="highlight"><c- n>output_size</c-></code> is not a null pointer, <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> is decremented by the number of code units written to the output.</p>
       </dl>
       <p>Otherwise, if an error is returned then none of the above occurs. If the return value is <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code>, then <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is in an unspecified state. If the return value is <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code> or <code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-></code>, then <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is not changed.</p>
      </div>
      <div> <span class="footnote-ref">FN✨4)</span><span class="footnote"> If <code class="highlight"><c- n>state</c-></code> is a null pointer, and the function uses the created automatic storage duration <code class="highlight"><c- b>mbstate_t</c-></code> object that is discarded by the end of the invocation, then any potential conversion state contained in the created <code class="highlight"><c- b>mbstate_t</c-></code> object and used during processing could become unrecoverable to the program.</span> </div>
      <p><br></p>
      <div class="wording-clause-section-title"> Recommended Practice </div>
      <div class="wording-numbered">
       <p>Implementations should take advantage of the information of null pointer values for the output size pointer, output data pointer, or both, to drastically improve performance characteristics for assumed unlimited write space, output counting scenarios, or input validation/counting, respectively.</p>
      </div>
      <div class="wording-numbered"> Implementations should prefer returning an error for an incomplete input sequence over storing intermediate data within the state where possible for non-Unicode encodings. This may make it easier for functionality built on top of the functions in this subclause to report errors without skipping over potentially invalid input data. </div>
     </div>
    </ins>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.9" id="wording-specification-7.S✨.3"><span class="secno">6.2.9. </span><span class="content">Create a new subsection §7.S✨.3 Multi Unit Sized Conversion Functions</span><a class="self-link" href="#wording-specification-7.S✨.3"></a></h4>
   <blockquote>
    <ins>
     <div class="wording-clause-header"> <span class="wording-clause-number">7.S✨.3</span> <span class="wording-clause-title">Multi Unit Sized Conversion Functions </span> </div>
     <div class="wording-section">
      <div class="wording-clause-section-title"> Synopsis </div>
      <div class="wording-numbered">
       <blockquote>
<pre class="language-cpp highlight"><c- cp>#include</c-> &lt;stdmchar.h>

<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mcsnrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_mwcsnrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c8snrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c16snrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->

<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtomcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtomwcsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>wchar_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtoc16sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char16_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
<c- n>stdc_mcerr</c-> <c- nf>stdc_c32snrtoc32sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
   <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char32_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
</pre>
       </blockquote>
      </div>
      <div class="wording-clause-section-title"> Description </div>
      <div class="wording-numbered">
       <p>Let <em>multi unit transcoding function</em> in this function be one of the functions listed above transcribed in the form</p>
<pre class="language-cpp highlight"><c- n>stdc_mcerr</c-> <c- nf>stdc_XsnrtoYsn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
  <c- n>charY</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- n>charX</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>state</c-><c- p>);</c->
</pre>
       <p>with the following properties:</p>
       <dl>
        <dd data-md>
         <p>— <em>X</em> and <em>Y</em> be one of the prefixes/suffixes in the table from 7.S✨.1;</p>
        <dd data-md>
         <p>— <i><code class="highlight"><c- n>charX</c-></code></i> and <i><code class="highlight"><c- n>charY</c-></code></i> be the associated code unit types for <em>X</em> and <em>Y</em> in the table from 7.S✨.1; and</p>
        <dd data-md>
         <p>— <em>encoding X</em> and <em>encoding Y</em> be the associated encoding types for <em>X</em> and <em>Y</em> in the table from 7.S✨.1.</p>
       </dl>
       <p>The multi unit transcoding functions take an input buffer and an output buffer of the associated code unit types, potentially with their sizes. The functions consume any number of code units to perform a sequence of indivisible units of work, which results in zero or more output code units. The functions will repeatedly perform an indivisible unit of work until either an error occurs or the input is exhausted.</p>
      </div>
      <div class="wording-numbered">
       <ins>
        <p>An <code class="highlight"><c- b>mbstate_t</c-></code> object assuredly describes the conversion state for the current conversion if it is not in an unspecified state (as described further below) and:</p>
        <ul>
         <li data-md>
          <p>the conversion is between Unicode encodings; or</p>
         <li data-md>
          <p>the input fragment is the start of an encoded sequence in the input encoding and the <code class="highlight"><c- b>mbstate_t</c-></code> object was initialized to the initial conversion state; or</p>
         <li data-md>
          <p>the input fragment is a continuation of an encoded sequence and <code class="highlight"><c- b>mbstate_t</c-></code> is the result of having advanced to the input and output positions through the application of prior calls to the same transcoding function.</p>
        </ul>
        <p>The behavior is undefined when a function described by this subclause is invoked and <code class="highlight"><c- o>*</c-><c- n>state</c-></code> (or, if <code class="highlight"><c- n>state</c-></code> is a null pointer, the <code class="highlight"><c- b>mbstate_t</c-></code> object created for that case) does not describe the conversion state for the current conversion.</p>
       </ins>
      </div>
      <div class="wording-numbered">
       <p>If <code class="highlight"><c- n>input_size</c-></code> is a null pointer, <code class="highlight"><c- n>input</c-></code> shall either be a null pointer or point to a null pointer. Otherwise, <code class="highlight"><c- n>input</c-></code> shall be a pointer to a non-null pointer to an array of at least <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> elements.</p>
      </div>
      <div class="wording-numbered">
       <p>The multi unit transcoding functions convert from code units of type <code class="highlight"><c- n>charX</c-></code> interpreted according to encoding X to code units of type <code class="highlight"><c- n>charY</c-></code> according to encoding Y given a conversion state of value <code class="highlight"><c- o>*</c-><c- n>state</c-></code>. The behavior of these functions is as-if the analogous single unit function <code class="highlight"><c- n>XntoYn</c-></code> was repeatedly called, with the same <code class="highlight"><c- n>output</c-></code>, <code class="highlight"><c- n>output_size</c-></code>, <code class="highlight"><c- n>input</c-></code>, <code class="highlight"><c- n>input_size</c-></code>, and <code class="highlight"><c- n>state</c-></code> parameters, to perform multiple indivisible units of work. The function stops when an error occurs or the input is exhausted (only signified when <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> is zero).</p>
      </div>
      <div class="wording-numbered">
        The multi unit transcoding functions behave as-if: 
       <dl>
        <dd data-md>
         <ol>
          <li data-md>
           <p>If <code class="highlight"><c- n>state</c-></code> is a null pointer, then an automatic storage duration object of type <code class="highlight"><c- b>mbstate_t</c-></code> is created which is unique to the current invocation. It is initialized to the initial conversion state and a pointer to this object is used wherever <code class="highlight"><c- n>state</c-></code> is used in this paragraph<span class="footnote-ref">FN✨5)</span>.</p>
         </ol>
        <dd data-md>
         <ol start="2">
          <li data-md>
           <p><code class="highlight"><c- n>stdc_XnrtoYn</c-></code> is called with <code class="highlight"><c- n>output_size</c-></code>, <code class="highlight"><c- n>output</c-></code>, <code class="highlight"><c- n>input_size</c-></code>, <code class="highlight"><c- n>input</c-></code>, and <code class="highlight"><c- n>state</c-></code> with its result stored in a temporary named <code class="highlight"><c- n>err</c-></code>.</p>
         </ol>
        <dd data-md>
         <ol start="3">
          <li data-md>
           <p>If <code class="highlight"><c- n>input</c-></code> is a null pointer or <code class="highlight"><c- o>*</c-><c- n>input</c-></code> is a null pointer, return <code class="highlight"><c- n>stdc_mcerr_ok</c-></code>.</p>
         </ol>
        <dd data-md>
         <ol start="4">
          <li data-md>
           <p>If <code class="highlight"><c- n>err</c-></code> is not <code class="highlight"><c- n>stdc_mcerr_ok</c-></code>, then return <code class="highlight"><c- n>err</c-></code>.</p>
         </ol>
        <dd data-md>
         <ol start="5">
          <li data-md>
           <p>Otherwise, if <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> greater than zero, go back to (2).</p>
         </ol>
        <dd data-md>
         <ol start="6">
          <li data-md>
           <p>Otherwise, call <code class="highlight"><c- n>mbsinit</c-><c- p>(</c-><c- o>*</c-><c- n>state</c-><c- p>)</c-></code> and store its result in a temporary named <code class="highlight"><c- n>state_finished</c-></code>.</p>
         </ol>
        <dd data-md>
         <ol start="7">
          <li data-md>
           <p>If <code class="highlight"><c- n>state_finished</c-></code> is zero, go back to (2).</p>
         </ol>
        <dd data-md>
         <ol start="8">
          <li data-md>
           <p>Otherwise, return <code class="highlight"><c- n>err</c-></code>;</p>
         </ol>
       </dl>
      </div>
      <div class="wording-clause-section-title"> Returns </div>
      <div class="wording-numbered">
       <p>On success or failure, the transcoding functions shall return one of the above error codes (7.S✨.1). If <code class="highlight"><c- n>state</c-></code> is not a null pointer and <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is not initialized to the initial conversion state for the function on its first use, or is used after being input into a function whose result is not one of <code class="highlight"><c- n>stdc_mcerr_ok</c-></code>, <code class="highlight"><c- n>stdc_mcerr_incomplete_input</c-></code>, or <code class="highlight"><c- n>stdc_mcerr_insufficient_output</c-></code>, the behavior of the functions is unspecified.</p>
      </div>
      <div class="wording-numbered">
        The following is true after the invocation: 
       <dl>
        <dd data-md>
         <p>— <code class="highlight"><c- o>*</c-><c- n>input</c-></code> will be incremented by the number of code units read and successfully converted if <code class="highlight"><c- n>input</c-></code> and <code class="highlight"><c- o>*</c-><c- n>input</c-></code> are not null pointers. If <code class="highlight"><c- n>stdc_mcerr_ok</c-></code> is returned, then this will consume all the input. Otherwise, <code class="highlight"><c- o>*</c-><c- n>input</c-></code> will point to the location just after the last successfully completed indivisible unit of work.</p>
        <dd data-md>
         <p>— <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> is decremented by the number of code units read from <code class="highlight"><c- o>*</c-><c- n>input</c-></code> that were successfully converted. If no error occurred, then <code class="highlight"><c- o>*</c-><c- n>input_size</c-></code> will be 0.</p>
        <dd data-md>
         <p>— if <code class="highlight"><c- n>output</c-></code> and <code class="highlight"><c- o>*</c-><c- n>output</c-></code> is not a null pointer, <code class="highlight"><c- o>*</c-><c- n>output</c-></code> will be incremented by the number of code units written from successfully completed indivisible unit of work.</p>
        <dd data-md>
         <p>— if <code class="highlight"><c- n>output_size</c-></code> is not a null pointer, <code class="highlight"><c- o>*</c-><c- n>output_size</c-></code> is decremented by the number of code units written to the output or that would have been written to the output.</p>
       </dl>
       <p>If the return value is <code class="highlight"><c- n>stdc_mcerr_invalid</c-></code> and <code class="highlight"><c- n>state</c-></code> is not a null pointer, then <code class="highlight"><c- o>*</c-><c- n>state</c-></code> is in an unspecified state.</p>
      </div>
      <div> <span class="footnote-ref">FN✨5)</span><span class="footnote"> The object to unique to the invocation is reused for every call in the second step of the multi unit sized conversion algorithm, and not recreated. If <code class="highlight"><c- n>state</c-></code> is a null pointer, and the function uses the created automatic storage duration <code class="highlight"><c- b>mbstate_t</c-></code> object that is discarded by the end of the invocation, then any potential conversion state contained in the created <code class="highlight"><c- b>mbstate_t</c-></code> object and used during processing could become unrecoverable to the program.</span> </div>
      <div class="wording-numbered">
       <p><strong>EXAMPLE 1</strong></p>
       <p>The following is an example of using a single indivisible unit sized conversion function <code class="highlight"><c- n>stdc_mcnrtoc8n</c-></code> to implement a multi unit sized conversion algorithm:</p>
<pre class="language-cpp highlight"><c- cp>#include</c-> &lt;stdmchar.h>

<c- n>stdc_mcerr</c-> <c- nf>sample_mcsnrtoc8sn</c-><c- p>(</c-><c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>output_size</c-><c- p>,</c->
  <c- b>char8_t</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>output</c-><c- p>,</c->
  <c- b>size_t</c-><c- o>*</c-><c- k>restrict</c-> <c- n>input_size</c-><c- p>,</c-> <c- k>const</c-> <c- b>char</c-><c- o>*</c-><c- k>restrict</c-> <c- o>*</c-><c- k>restrict</c-> <c- n>input</c-><c- p>,</c->
  <c- b>mbstate_t</c-><c- o>*</c-> <c- k>restrict</c-> <c- n>state</c-><c- p>)</c-> <c- p>{</c->
  <c- b>mbstate_t</c-> <c- n>invocation_unique_internal_state</c-><c- p>;</c->
  <c- k>if</c-> <c- p>(</c-><c- n>state</c-> <c- o>==</c-> <c- k>nullptr</c-><c- p>)</c-> <c- p>{</c->
    <c- n>unique_internal_state</c-> <c- o>=</c-> <c- p>(</c-><c- b>mbstate_t</c-><c- p>){};</c->
    <c- n>state</c-> <c- o>=</c-> <c- o>&amp;</c-><c- n>invocation_unique_internal_state</c-><c- p>;</c->
  <c- p>}</c->
  <c- k>if</c-> <c- p>(</c-><c- n>input</c-> <c- o>==</c-> <c- k>nullptr</c-> <c- o>||</c-> <c- o>*</c-><c- n>input</c-> <c- o>==</c-> <c- k>nullptr</c-><c- p>)</c-> <c- p>{</c->
    <c- k>return</c-> <c- n>stdc_mcnrtoc8n</c-><c- p>(</c-><c- n>output_size</c-><c- p>,</c-> <c- n>output</c-><c- p>,</c->
      <c- n>input_size</c-><c- p>,</c-> <c- n>input</c-><c- p>,</c-> <c- n>state</c-><c- p>);</c->
  <c- p>}</c->
  <c- k>for</c-> <c- p>(;;)</c-> <c- p>{</c->
    <c- n>stdc_mcerr</c-> <c- n>err</c-> <c- o>=</c-> <c- n>stdc_mcnrtoc8n</c-><c- p>(</c-><c- n>output_size</c-><c- p>,</c-> <c- n>output</c-><c- p>,</c->
      <c- n>input_size</c-><c- p>,</c-> <c- n>input</c-><c- p>,</c-> <c- n>state</c-><c- p>);</c->
    <c- k>if</c-> <c- p>(</c-><c- n>err</c-> <c- o>!=</c-> <c- n>stdc_mcerr_ok</c-><c- p>)</c-> <c- p>{</c->
      <c- k>return</c-> <c- n>err</c-><c- p>;</c->
    <c- p>}</c->
    <c- k>if</c-> <c- p>(</c-><c- o>*</c-><c- n>input_size</c-> <c- o>></c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
      <c- k>continue</c-><c- p>;</c->
    <c- p>}</c->
    <c- c1>// some execution encodings (6.2.9) may contain</c->
    <c- c1>// additional output as input gets processed</c->
    <c- b>int</c-> <c- n>state_finished</c-> <c- o>=</c-> <c- n>mbsinit</c-><c- p>(</c-><c- n>state</c-><c- p>);</c->
    <c- k>if</c-> <c- p>(</c-><c- n>state_finished</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
      <c- k>continue</c-><c- p>;</c->
    <c- p>}</c->
    <c- k>return</c-> <c- n>err</c-><c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
      </div>
      <div class="wording-numbered">
       <p><strong>EXAMPLE 2</strong></p>
       <p>The multi unit sized conversion functions can be used to perform other functionality, such as counting, validation, and more by using a null pointer value for specific arguments:</p>
<pre class="language-cpp highlight"><c- cp>#include</c-> &lt;stdmchar.h>

<c- b>bool</c-> <c- nf>is_valid_utf16_from_utf8</c-><c- p>(</c-><c- b>size_t</c-> <c- n>str_n</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-> <c- n>str</c-><c- p>[</c-><c- k>restrict</c-> <c- k>static</c-> <c- n>str_n</c-><c- p>])</c-> <c- p>{</c->
  <c- n>stdc_mcerr</c-> <c- n>err</c-> <c- o>=</c-> <c- n>stdc_c8snrtoc16sn</c-><c- p>(</c-><c- k>nullptr</c-><c- p>,</c-> <c- k>nullptr</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>str_n</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>str</c-><c- p>);</c->
  <c- k>return</c-> <c- n>err</c-> <c- o>==</c-> <c- n>stdc_mcerr_ok</c-><c- p>;</c->
<c- p>}</c->

<c- b>size_t</c-> <c- nf>count_utf16_from_utf8</c-><c- p>(</c-><c- b>size_t</c-> <c- n>str_n</c-><c- p>,</c-> <c- k>const</c-> <c- b>char8_t</c-> <c- n>str</c-><c- p>[</c-><c- k>restrict</c-> <c- k>static</c-> <c- n>str_n</c-><c- p>])</c-> <c- p>{</c->
  <c- k>const</c-> <c- b>size_t</c-> <c- n>utf16_before_n</c-> <c- o>=</c-> <c- n>SIZE_MAX</c-><c- p>;</c->
  <c- b>size_t</c-> <c- n>utf16_after_n</c-> <c- o>=</c-> <c- n>utf16_before_n</c-><c- p>;</c->
  <c- n>stdc_mcerr</c-> <c- n>err</c-> <c- o>=</c-> <c- n>stdc_c8snrtoc16sn</c-><c- p>(</c-><c- o>&amp;</c-><c- n>utf16_after_n</c-><c- p>,</c-> <c- k>nullptr</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>str_n</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>str</c-><c- p>);</c->
  <c- k>return</c-> <c- n>err</c-> <c- o>==</c-> <c- n>stdc_mcerr_ok</c-> <c- o>?</c-> <c- n>utf16_before_n</c-> <c- o>-</c-> <c- n>utf16_after_n</c-> <c- o>:</c-> <c- mi>0</c-><c- p>;</c-> 
<c- p>}</c->

<c- b>bool</c-> <c- nf>unbounded_conversion_utf16_from_utf8</c-><c- p>(</c-><c- b>size_t</c-> <c- n>str_n</c-><c- p>,</c->
  <c- k>const</c-> <c- b>char8_t</c-> <c- n>str</c-><c- p>[</c-><c- k>restrict</c-> <c- k>static</c-> <c- n>str_n</c-><c- p>],</c->
  <c- b>char16_t</c-><c- o>*</c-> <c- k>restrict</c-> <c- n>dest_str</c-><c- p>)</c-> <c- p>{</c->
  <c- n>stdc_mcerr</c-> <c- n>err</c-> <c- o>=</c-> <c- n>stdc_c8snrtoc16sn</c-><c- p>(</c-><c- k>nullptr</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>dest_str</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>str_n</c-><c- p>,</c-> <c- o>&amp;</c-><c- n>str</c-><c- p>);</c->
  <c- k>return</c-> <c- n>err</c-> <c- o>==</c-> <c- n>stdc_mcerr_ok</c-><c- p>;</c-> 
<c- p>}</c->

<c- b>int</c-> <c- nf>main</c-> <c- p>()</c-> <c- p>{</c->
  <c- k>const</c-> <c- b>char8_t</c-> <c- n>str</c-><c- p>[]</c-> <c- o>=</c-> u8<c- s>"</c-><c- se>\"</c-><c- s>Saw a </c-><c- se>\U0001F9DC</c-><c- s> </c-><c- se>\u2014</c-><c- s>"</c->
                        u8<c- s>"didn’t catch her</c-><c- se>\u2026</c-><c- s> </c-><c- se>\U0001F61E\"\n\t</c-><c- s>- Sniff"</c-><c- p>;</c->
  <c- c1>// include null terminator</c->
  <c- k>const</c-> <c- b>size_t</c-> <c- n>str_n</c-> <c- o>=</c-> <c- p>(</c-><c- k>sizeof</c-><c- p>(</c-><c- n>str</c-><c- p>)</c-> <c- o>/</c-> <c- k>sizeof</c-><c- p>(</c-><c- o>*</c-><c- n>str</c-><c- p>));</c->
	
  <c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- n>is_valid_utf16_from_utf8</c-><c- p>(</c-><c- n>str_n</c-><c- p>,</c-> <c- n>str</c-><c- p>))</c-> <c- p>{</c->
    <c- c1>// input not valid</c->
    <c- k>return</c-> <c- mi>1</c-><c- p>;</c->
  <c- p>}</c->

  <c- b>size_t</c-> <c- n>utf16_str_n</c-> <c- o>=</c-> <c- n>count_utf16_from_utf8</c-><c- p>(</c-><c- n>str_n</c-><c- p>,</c-> <c- n>str</c-><c- p>);</c->
  <c- k>constexpr</c-> <c- b>size_t</c-> <c- n>utf16_str_max_size</c-> <c- o>=</c-> <c- n>STDC_C16_MAX</c-> <c- o>*</c-> <c- p>(</c-><c- k>sizeof</c-><c- p>(</c-><c- n>str</c-><c- p>)</c-> <c- o>/</c-> <c- k>sizeof</c-><c- p>(</c-><c- o>*</c-><c- n>str</c-><c- p>));</c->
  <c- b>char16_t</c-> <c- n>utf16_str</c-><c- p>[</c-><c- n>utf16_str_max_size</c-><c- p>]</c-> <c- o>=</c-> <c- p>{};</c->
  <c- k>if</c-> <c- p>(</c-><c- n>utf16_str_max_size</c-> <c- o>&lt;</c-> <c- n>utf16_str_n</c-><c- p>)</c-> <c- p>{</c->
    <c- c1>// buffer too small</c->
    <c- k>return</c-> <c- mi>2</c-><c- p>;</c->
  <c- p>}</c->

  <c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- n>unbounded_conversion_utf16_from_utf8</c-><c- p>(</c-><c- n>str_n</c-><c- p>,</c-> <c- n>str</c-><c- p>,</c-> <c- n>utf16_str</c-><c- p>))</c-> <c- p>{</c->
    <c- c1>// write failed</c->
    <c- k>return</c-> <c- mi>3</c-><c- p>;</c->
  <c- p>}</c->
  <c- c1>// At this point, utf16_str is a veritable UTF-16 string.</c->
  <c- c1>// As noted above, null terminator from utf8_str was included:</c->
  <c- c1>// utf16_str is a sequence of UTF-16 code units plus the null</c->
  <c- c1>// terminator, in a suitable form at the end of the UTF-16 string.</c->
  <c- k>return</c-> <c- mi>0</c-><c- p>;</c->
<c- p>}</c->
</pre>
       <p>The above program demonstrates validating, counting, and doing an unbounded (size unsafe) write using the provided functions. Caution should be taken when a program uses unbounded writes, as the size of the buffer is assumed to be large enough during the call to the multi unit sized conversion function when <code class="highlight"><c- n>output_size</c-></code> is a null pointer. An implementation may detect the above cases where specific arguments or their pointed to values are a null pointer value, and provide improved implementations relying on assumptions from these qualities.</p>
      </div>
      <div class="wording-clause-section-title"> Recommended Practice </div>
      <div class="wording-numbered">
       <p>The multi unit transcoding functions are explicitly for the purpose of performing conversions on the largest contiguous section of valid data in the shortest amount of time possible. Implementations should take advantage of the information of null pointer values for the output size pointer, output data pointer, or both, to drastically improve performance characteristics for assumed unlimited write space, output counting scenarios, or input validation/counting, respectively.</p>
      </div>
      <div class="wording-numbered"> Implementations should prefer returning an error for an incomplete input sequence over storing intermediate data within the state where possible for non-Unicode encodings. By leaving partial input unconsumed, it can be easier for functionality built on top of the functions in this subclause to report errors without skipping over potentially invalid input data. </div>
     </div>
    </ins>
   </blockquote>
   <h4 class="heading settled" data-level="6.2.10" id="wording-specification-j.1"><span class="secno">6.2.10. </span><span class="content">Add unspecified behavior to Annex J.1 Unspecified behavior</span><a class="self-link" href="#wording-specification-j.1"></a></h4>
   <blockquote>
    <div class="wording-clause-header"> <span class="wording-clause-number">J.1</span> <span class="wording-clause-title">Unspecified Behavior</span> </div>
    <div class="wording-section">
     <div class="wording-numbered">
       The following are unspecified: 
      <dl>
       <dd data-md>
        <p>…</p>
       <dd data-md>
        <p>
         — The conversion state after an encoding error
         <ins> (6.2.9)</ins>
          occurs (7.30.6.3.2, 7.30.6.3.3, 7.30.6.4.1, 7.30.6.4.2).
        </p>
       <dd data-md>
        <ins>— The conversion state after a unrecorded encoding error (6.2.9) occurs (7.S✨).</ins>
       <dd data-md>
        <p>…</p>
      </dl>
     </div>
    </div>
   </blockquote>
   <h2 class="heading settled" data-level="7" id="acknowledgements"><span class="secno">7. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Thank you to Philipp K. Krause for responding to the e-mails of a newcomer to matters of C and providing me with helpful guidance. Thank you to Rajan Bhakta, Daniel Plakosh, and David Keaton for guidance on how to submit these papers and get started in WG14. Thank you to Tom Honermann for lighting the passionate fire for proper text handling in me for not just C++, but for our sibling language C.</p>
   <h2 class="heading settled" data-level="8" id="appendix"><span class="secno">8. </span><span class="content">Appendix</span><a class="self-link" href="#appendix"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="appendix-proposed-utf"><span class="secno">8.1. </span><span class="content">(From revisions 0-3) What about UTF{X} ↔ UTF{Y} functions?</span><a class="self-link" href="#appendix-proposed-utf"></a></h3>
   <p>Function interconverting between different Unicode Transformation Formats are not proposed here because -- while useful -- both sides of the encoding are statically known by the developer. The C Standard only wants to consider functionality strictly in the case where the implementation has more information / private information that the developer cannot access in a well-defined and standard manner. A developer can write their own Unicode Transformation Format conversion routines and get them completely right, whereas a developer cannot write the Wide Character and Multibyte Character functions without incredible heroics and/or error-prone assumptions.</p>
   <p>This brings up an interesting point, however: if <code class="highlight"><c- n>__STDC_UTF16__</c-></code> and <code class="highlight"><c- n>__STDC_UTF32__</c-></code> both exist, does that not mean the implementation controls what <code class="highlight"><c- n>c16</c-></code> and <code class="highlight"><c- n>c32</c-></code> mean? This is true, <strong>however</strong>: within a (admittedly limited) survey of implementations, there has been no suggestion or report of an implementation which does not use UTF16 and UTF32 for their <code class="highlight"><c- n>char16_t</c-></code> and <code class="highlight"><c- n>char32_t</c-></code> literals, respectively.</p>
   <p>Thankfully, that does not seem to be the case at this time. It will also no longer be the case in C23, as the paper <a data-link-type="biblio" href="#biblio-n2728" title="char16_t and char32_t shall be UTF-16 and UTF-32">char16_t and char32_t literals should be UTF-16 and UTF-32</a> has been accepted. (Note: this paper has been accepted.)</p>
   <p><sub><sub><sub>May the Tower of Babel’s curse be defeated.</sub></sub></sub></p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-clang-iso10646">[CLANG-ISO10646]
   <dd>Corentin Jabot. <a href="https://reviews.llvm.org/D106577"><cite>Define __STDC_ISO_10646__</cite></a>. June 22nd, 2021. URL: <a href="https://reviews.llvm.org/D106577">https://reviews.llvm.org/D106577</a>
   <dt id="biblio-cuneicode">[CUNEICODE]
   <dd>JeanHeyd Meneide; Shepherd's Oasis, LLC. <a href="https://ztdcuneicode.rtfd.io"><cite>cuneicode - A spicy text library for C</cite></a>. November 20th, 2021. URL: <a href="https://ztdcuneicode.rtfd.io">https://ztdcuneicode.rtfd.io</a>
   <dt id="biblio-glibc-25744">[GLIBC-25744]
   <dd>Tom Honermann; Carlos O'Donnell. <a href="https://sourceware.org/bugzilla/show_bug.cgi?id=25744"><cite>`mbrtowc` with Big5-HKSCS returns 2 instead of 1 when consuming the second byte of certain double byte characters</cite></a>. URL: <a href="https://sourceware.org/bugzilla/show_bug.cgi?id=25744">https://sourceware.org/bugzilla/show_bug.cgi?id=25744</a>
   <dt id="biblio-iconv">[ICONV]
   <dd>Bruno Haible; Daiki Ueno. <a href="https://savannah.gnu.org/git/?group=libiconv"><cite>libiconv</cite></a>. August 2020. URL: <a href="https://savannah.gnu.org/git/?group=libiconv">https://savannah.gnu.org/git/?group=libiconv</a>
   <dt id="biblio-lemire-spire2021">[LEMIRE-SPIRE2021]
   <dd>Daniel Lemire. <a href="https://doi.org/10.48550/arXiv.2111.08692"><cite>Unicode at Gigabytes per Second</cite></a>. November 14th, 2021. URL: <a href="https://doi.org/10.48550/arXiv.2111.08692">https://doi.org/10.48550/arXiv.2111.08692</a>
   <dt id="biblio-n1570">[N1570]
   <dd>ISO/IEC JTC1 SC22 WG14 - Programming Languages, C. <a href="https://www.open-std.org/jtc1/sc22/WG14/www/docs/n1570.pdf"><cite>C11 Committee Draft</cite></a>. April 12, 2011. URL: <a href="https://www.open-std.org/jtc1/sc22/WG14/www/docs/n1570.pdf">https://www.open-std.org/jtc1/sc22/WG14/www/docs/n1570.pdf</a>
   <dt id="biblio-n2244">[N2244]
   <dd>WG14. <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2244.htm"><cite>Clarification Request Summary for C11, Version 1.13</cite></a>. October 2017. URL: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2244.htm">https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2244.htm</a>
   <dt id="biblio-n2282">[N2282]
   <dd>Philip K. Krause. <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2282.htm"><cite>Additional multibyte/wide string conversion functions</cite></a>. June 2018. URL: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2282.htm">https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2282.htm</a>
   <dt id="biblio-n2728">[N2728]
   <dd>JeanHeyd Meneide. <a href="https://thephd.dev/_vendor/future_cxx/papers/C%20-%20char16_t%20&amp;%20char32_t%20string%20literals%20shall%20be%20UTF-16%20&amp;%20UTF-32.html"><cite>char16_t and char32_t shall be UTF-16 and UTF-32</cite></a>. May 15th, 20201. URL: <a href="https://thephd.dev/_vendor/future_cxx/papers/C%20-%20char16_t%20&amp;%20char32_t%20string%20literals%20shall%20be%20UTF-16%20&amp;%20UTF-32.html">https://thephd.dev/_vendor/future_cxx/papers/C%20-%20char16_t%20&amp;%20char32_t%20string%20literals%20shall%20be%20UTF-16%20&amp;%20UTF-32.html</a>
   <dt id="biblio-n2892">[N2892]
   <dd>Jens Gustedt. <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2892.pdf"><cite>N2892: Basic lambdas for C</cite></a>. URL: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2892.pdf">https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2892.pdf</a>
   <dt id="biblio-n3054">[N3054]
   <dd>ISO/IEC JTC1 SC22 WG14 - Programming Languages, C; JeanHeyd Meneide; Freek Wiedijk. <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3054.pdf"><cite>n3054: ISO/IEC 9899:202x - Programming Languages, C</cite></a>. September 3rd, 2022. URL: <a href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3054.pdf">https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3054.pdf</a>
   <dt id="biblio-p2460r2">[P2460R2]
   <dd>Corentin Jabot. <a href="https://wg21.link/p2460r2"><cite>Relax requirements on wchar_t to match existing practices</cite></a>. 15 July 2022. URL: <a href="https://wg21.link/p2460r2">https://wg21.link/p2460r2</a>
   <dt id="biblio-unicode_deep_c_diving">[Unicode_deep_c_diving]
   <dd>JeanHeyd Meneide. <a href="https://youtu.be/X-FLGsa8LVc"><cite>Deep C Diving - Fast and Scalable Text Interfaces at the Bottom</cite></a>. July 2020. URL: <a href="https://youtu.be/X-FLGsa8LVc">https://youtu.be/X-FLGsa8LVc</a>
   <dt id="biblio-unicode_greater_detail">[Unicode_greater_detail]
   <dd>JeanHeyd Meneide. <a href="https://www.youtube.com/watch?v=FQHofyOgQtM"><cite>Catching ⬆️: Unicode for C++ in Greater Detail</cite></a>. November 2019. URL: <a href="https://www.youtube.com/watch?v=FQHofyOgQtM">https://www.youtube.com/watch?v=FQHofyOgQtM</a>
  </dl>