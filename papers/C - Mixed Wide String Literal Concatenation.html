<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="JeanHeyd Meneide &lt;phdofthehouse@gmail.com&gt;" />
  <title>Mixed Wide String Literal Concatenation</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Mixed Wide String Literal Concatenation</h1>
<p class="author">JeanHeyd Meneide &lt;<a href="mailto:phdofthehouse@gmail.com" class="email">phdofthehouse@gmail.com</a>&gt;</p>
<p class="date">October 26th, 2020</p>
</header>
<style>
pre {
  margin-top: 0px;
  margin-bottom: 0px;
}
.ins, ins, ins *, span.ins, span.ins * {
  background-color: rgb(200, 250, 200);
  color: rgb(0, 136, 0);
  text-decoration: underline;
}
.del, del, del *, span.del, span.del * {
  background-color: rgb(250, 200, 200);
  color: rgb(255, 0, 0);
  text-decoration: line-through;
  text-decoration-color: rgb(255, 0, 0);
}
math, span.math {
  font-family: serif;
  font-style: italic;
}
ul {
  list-style-type: "— ";
}
blockquote {
  counter-reset: paragraph;
}
div.numbered, div.newnumbered {
  margin-left: 2em;
  margin-top: 1em;
  margin-bottom: 1em;
}
div.numbered:before, div.newnumbered:before {
  position: absolute;
  margin-left: -2em;
  display-style: block;
}
div.numbered:before {
  content: counter(paragraph);
  counter-increment: paragraph;
}
div.newnumbered:before {
  content: "�";
}
div.numbered ul, div.newnumbered ul {
  counter-reset: list_item;
}
div.numbered li, div.newnumbered li {
  margin-left: 3em;
}
div.numbered li:before, div.newnumbered li:before {
  position: absolute;
  margin-left: -4.8em;
  display-style: block;
}
div.numbered li:before {
  content: "(" counter(paragraph) "." counter(list_item) ")";
  counter-increment: list_item;
}
div.newnumbered li:before {
  content: "(�." counter(list_item) ")";
  counter-increment: list_item;
}
</style>
<p><em><strong>Document</strong></em>: n2593<br />
<em><strong>Previous Revisions</strong></em>: None<br />
<em><strong>Audience</strong></em>: WG14<br />
<em><strong>Proposal Category</strong></em>: New Features<br />
<em><strong>Target Audience</strong></em>: General Developers, Compiler/Tooling Developers<br />
<em><strong>Latest Revision</strong></em>: <a href="https://thephd.github.io/vendor/future_cxx/papers/source/n2593.html">https://thephd.github.io/vendor/future_cxx/papers/source/n2593.html</a></p>
<p style="text-align: center">
<span style="font-style: italic; font-weight: bold">Abstract:</span>
<p>
Many functions return a value, however, not all function return values are of equal importance to the caller. The recent <code>[[nodiscard]]</code> attribute allows compilers to issue a diagnostics, but only hands the user a generic error message. This proposal enhances the <code>[[nodiscard]]</code> attribute in the same manner as the <code>[[deprecated]]</code> attribute, giving developers the same power to guide their users to better APIs with the aid of the compiler by providing a <code>string literal</code> attribute argument clause.
</p>
</p>
<div class="pagebreak">

</div>
<h1 id="introduction-motivation"><span class="header-section-number">1</span> Introduction &amp; Motivation</h1>
<p>This paper is a compatibility-parity and query paper to resolve a Liason request from WG21 - Programming Languages, C++. It is almost identical to <a href="https://wg21.link/p2201">p2201</a>.</p>
<p>String concatenation involving string-literals with encoding-prefixes mixing L"“, u8”“, u”“, and U”" is currently conditionally-supported with implementation-defined behavior (<a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2573.pdf">N2573 §6.4.5 String literals, Semantics, paragraph 5</a>).</p>
<p>None of <a href="https://compiler-explorer.com/z/hx4TTf">icc, gcc, clang, MSVC supports such mixed concatenations; all issue an error</a>. Test code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="dt">void</span> f() {</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">L&quot;&quot;</span> <span class="st">u&quot;&quot;</span>; }</span>
<span id="cb1-4"><a href="#cb1-4"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">L&quot;&quot;</span> <span class="st">u8&quot;&quot;</span>; }</span>
<span id="cb1-5"><a href="#cb1-5"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">L&quot;&quot;</span> <span class="st">U&quot;&quot;</span>; }</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">u8&quot;&quot;</span> <span class="st">L&quot;&quot;</span>; }</span>
<span id="cb1-8"><a href="#cb1-8"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">u8&quot;&quot;</span> <span class="st">u&quot;&quot;</span>; }</span>
<span id="cb1-9"><a href="#cb1-9"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">u8&quot;&quot;</span> <span class="st">U&quot;&quot;</span>; }</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">u&quot;&quot;</span> <span class="st">L&quot;&quot;</span>; }</span>
<span id="cb1-12"><a href="#cb1-12"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">u&quot;&quot;</span> <span class="st">u8&quot;&quot;</span>; }</span>
<span id="cb1-13"><a href="#cb1-13"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">u&quot;&quot;</span> <span class="st">U&quot;&quot;</span>; }</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">U&quot;&quot;</span> <span class="st">L&quot;&quot;</span>; }</span>
<span id="cb1-16"><a href="#cb1-16"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">U&quot;&quot;</span> <span class="st">u&quot;&quot;</span>; }</span>
<span id="cb1-17"><a href="#cb1-17"></a>  { <span class="at">const</span> <span class="dt">void</span>* a = <span class="st">U&quot;&quot;</span> <span class="st">u8&quot;&quot;</span>; }</span>
<span id="cb1-18"><a href="#cb1-18"></a>}</span></code></pre></div>
<p><a href="http://sdcc.sourceforge.net/">SDCC, the Small Device C Compiler</a>, does support such mixed concatenations, apparently taking the first encoding-prefix. One of its primary maintainers expressed sentiment that <a href="http://open-std.org/jtc1/sc22/wg14/18105">the feature is not actually used much</a>.</p>
<p>No meaningful use-case for such mixed concatenations is known, other than potential macro concatenation. However, no such usage experience was brought forth, and it is unlikely that code that uses multiple toolsets would be capable of taking advantage of such a feature since it is not present in many tools.</p>
<p>Therefore, this paper makes such mixed concatenations ill-formed.</p>
<h1 id="wording"><span class="header-section-number">2</span> Wording</h1>
<p>The following wording is relative to <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2573.pdf">N2573</a>.</p>
<h3 id="add-the-following-sentence-to-6.4.5-string-literals-constraints"><span class="header-section-number">2.0.1</span> Add the following sentence to §6.4.5 String Literals, Constraints</h3>
<blockquote>
<p>
<sup>2</sup> A sequence of adjacent string literal tokens shall not include both a wide string literal and aUTF–8string literal. <ins>Differently-prefixed wide string literal tokens are a constraint violation.</ins>
</p>
</blockquote>
<h3 id="remove-the-following-words-6.4.5-string-literals-semantics"><span class="header-section-number">2.0.2</span> Remove the following words §6.4.5 String literals, Semantics</h3>
<blockquote>
<p>
<sup>5</sup> In translation phase 6, the multibyte character sequences specified by any sequence of adjacent character and identically-prefixed string literal tokens are concatenated into a single multibyte character sequence. If any of the tokens has an encoding prefix, the resulting multibyte character sequence is treated as having the same prefix; otherwise, it is treated as a character string literal. <del>Whether differently-prefixed wide string literal tokens can be concatenated and, if so, the treatment of the resulting multibyte character sequence are implementation-defined.</del>
</p>
</blockquote>
</body>
</html>
